(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&e(a)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}})();/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */var at;const Ke=window,_e=Ke.trustedTypes,Bt=_e?_e.createPolicy("lit-html",{createHTML:n=>n}):void 0,gt="$lit$",he=`lit$${(Math.random()+"").slice(9)}$`,sn="?"+he,Vn=`<${sn}>`,me=document,Te=()=>me.createComment(""),ze=n=>n===null||typeof n!="object"&&typeof n!="function",on=Array.isArray,Wn=n=>on(n)||typeof(n==null?void 0:n[Symbol.iterator])=="function",st=`[ 	
\f\r]`,Ce=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Rt=/-->/g,Tt=/>/g,de=RegExp(`>|${st}(?:([^\\s"'>=/]+)(${st}*=${st}*(?:[^ 	
\f\r"'\`<>=]|("|')|))|$)`,"g"),zt=/'/g,Nt=/"/g,ln=/^(?:script|style|textarea|title)$/i,On=n=>(t,...r)=>({_$litType$:n,strings:t,values:r}),O=On(1),Ne=Symbol.for("lit-noChange"),X=Symbol.for("lit-nothing"),It=new WeakMap,ve=me.createTreeWalker(me,129,null,!1);function cn(n,t){if(!Array.isArray(n)||!n.hasOwnProperty("raw"))throw Error("invalid template strings array");return Bt!==void 0?Bt.createHTML(t):t}const qn=(n,t)=>{const r=n.length-1,e=[];let i,s=t===2?"<svg>":"",a=Ce;for(let o=0;o<r;o++){const l=n[o];let c,d,f=-1,p=0;for(;p<l.length&&(a.lastIndex=p,d=a.exec(l),d!==null);)p=a.lastIndex,a===Ce?d[1]==="!--"?a=Rt:d[1]!==void 0?a=Tt:d[2]!==void 0?(ln.test(d[2])&&(i=RegExp("</"+d[2],"g")),a=de):d[3]!==void 0&&(a=de):a===de?d[0]===">"?(a=i??Ce,f=-1):d[1]===void 0?f=-2:(f=a.lastIndex-d[2].length,c=d[1],a=d[3]===void 0?de:d[3]==='"'?Nt:zt):a===Nt||a===zt?a=de:a===Rt||a===Tt?a=Ce:(a=de,i=void 0);const x=a===de&&n[o+1].startsWith("/>")?" ":"";s+=a===Ce?l+Vn:f>=0?(e.push(c),l.slice(0,f)+gt+l.slice(f)+he+x):l+he+(f===-2?(e.push(void 0),o):x)}return[cn(n,s+(n[r]||"<?>")+(t===2?"</svg>":"")),e]};class Ie{constructor({strings:t,_$litType$:r},e){let i;this.parts=[];let s=0,a=0;const o=t.length-1,l=this.parts,[c,d]=qn(t,r);if(this.el=Ie.createElement(c,e),ve.currentNode=this.el.content,r===2){const f=this.el.content,p=f.firstChild;p.remove(),f.append(...p.childNodes)}for(;(i=ve.nextNode())!==null&&l.length<o;){if(i.nodeType===1){if(i.hasAttributes()){const f=[];for(const p of i.getAttributeNames())if(p.endsWith(gt)||p.startsWith(he)){const x=d[a++];if(f.push(p),x!==void 0){const _=i.getAttribute(x.toLowerCase()+gt).split(he),g=/([.?@])?(.*)/.exec(x);l.push({type:1,index:s,name:g[2],strings:_,ctor:g[1]==="."?Yn:g[1]==="?"?Un:g[1]==="@"?Kn:nt})}else l.push({type:6,index:s})}for(const p of f)i.removeAttribute(p)}if(ln.test(i.tagName)){const f=i.textContent.split(he),p=f.length-1;if(p>0){i.textContent=_e?_e.emptyScript:"";for(let x=0;x<p;x++)i.append(f[x],Te()),ve.nextNode(),l.push({type:2,index:++s});i.append(f[p],Te())}}}else if(i.nodeType===8)if(i.data===sn)l.push({type:2,index:s});else{let f=-1;for(;(f=i.data.indexOf(he,f+1))!==-1;)l.push({type:7,index:s}),f+=he.length-1}s++}}static createElement(t,r){const e=me.createElement("template");return e.innerHTML=t,e}}function Ee(n,t,r=n,e){var i,s,a,o;if(t===Ne)return t;let l=e!==void 0?(i=r._$Co)===null||i===void 0?void 0:i[e]:r._$Cl;const c=ze(t)?void 0:t._$litDirective$;return(l==null?void 0:l.constructor)!==c&&((s=l==null?void 0:l._$AO)===null||s===void 0||s.call(l,!1),c===void 0?l=void 0:(l=new c(n),l._$AT(n,r,e)),e!==void 0?((a=(o=r)._$Co)!==null&&a!==void 0?a:o._$Co=[])[e]=l:r._$Cl=l),l!==void 0&&(t=Ee(n,l._$AS(n,t.values),l,e)),t}class Gn{constructor(t,r){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=r}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){var r;const{el:{content:e},parts:i}=this._$AD,s=((r=t==null?void 0:t.creationScope)!==null&&r!==void 0?r:me).importNode(e,!0);ve.currentNode=s;let a=ve.nextNode(),o=0,l=0,c=i[0];for(;c!==void 0;){if(o===c.index){let d;c.type===2?d=new Ve(a,a.nextSibling,this,t):c.type===1?d=new c.ctor(a,c.name,c.strings,this,t):c.type===6&&(d=new jn(a,this,t)),this._$AV.push(d),c=i[++l]}o!==(c==null?void 0:c.index)&&(a=ve.nextNode(),o++)}return ve.currentNode=me,s}v(t){let r=0;for(const e of this._$AV)e!==void 0&&(e.strings!==void 0?(e._$AI(t,e,r),r+=e.strings.length-2):e._$AI(t[r])),r++}}class Ve{constructor(t,r,e,i){var s;this.type=2,this._$AH=X,this._$AN=void 0,this._$AA=t,this._$AB=r,this._$AM=e,this.options=i,this._$Cp=(s=i==null?void 0:i.isConnected)===null||s===void 0||s}get _$AU(){var t,r;return(r=(t=this._$AM)===null||t===void 0?void 0:t._$AU)!==null&&r!==void 0?r:this._$Cp}get parentNode(){let t=this._$AA.parentNode;const r=this._$AM;return r!==void 0&&(t==null?void 0:t.nodeType)===11&&(t=r.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,r=this){t=Ee(this,t,r),ze(t)?t===X||t==null||t===""?(this._$AH!==X&&this._$AR(),this._$AH=X):t!==this._$AH&&t!==Ne&&this._(t):t._$litType$!==void 0?this.g(t):t.nodeType!==void 0?this.$(t):Wn(t)?this.T(t):this._(t)}k(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}$(t){this._$AH!==t&&(this._$AR(),this._$AH=this.k(t))}_(t){this._$AH!==X&&ze(this._$AH)?this._$AA.nextSibling.data=t:this.$(me.createTextNode(t)),this._$AH=t}g(t){var r;const{values:e,_$litType$:i}=t,s=typeof i=="number"?this._$AC(t):(i.el===void 0&&(i.el=Ie.createElement(cn(i.h,i.h[0]),this.options)),i);if(((r=this._$AH)===null||r===void 0?void 0:r._$AD)===s)this._$AH.v(e);else{const a=new Gn(s,this),o=a.u(this.options);a.v(e),this.$(o),this._$AH=a}}_$AC(t){let r=It.get(t.strings);return r===void 0&&It.set(t.strings,r=new Ie(t)),r}T(t){on(this._$AH)||(this._$AH=[],this._$AR());const r=this._$AH;let e,i=0;for(const s of t)i===r.length?r.push(e=new Ve(this.k(Te()),this.k(Te()),this,this.options)):e=r[i],e._$AI(s),i++;i<r.length&&(this._$AR(e&&e._$AB.nextSibling,i),r.length=i)}_$AR(t=this._$AA.nextSibling,r){var e;for((e=this._$AP)===null||e===void 0||e.call(this,!1,!0,r);t&&t!==this._$AB;){const i=t.nextSibling;t.remove(),t=i}}setConnected(t){var r;this._$AM===void 0&&(this._$Cp=t,(r=this._$AP)===null||r===void 0||r.call(this,t))}}class nt{constructor(t,r,e,i,s){this.type=1,this._$AH=X,this._$AN=void 0,this.element=t,this.name=r,this._$AM=i,this.options=s,e.length>2||e[0]!==""||e[1]!==""?(this._$AH=Array(e.length-1).fill(new String),this.strings=e):this._$AH=X}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(t,r=this,e,i){const s=this.strings;let a=!1;if(s===void 0)t=Ee(this,t,r,0),a=!ze(t)||t!==this._$AH&&t!==Ne,a&&(this._$AH=t);else{const o=t;let l,c;for(t=s[0],l=0;l<s.length-1;l++)c=Ee(this,o[e+l],r,l),c===Ne&&(c=this._$AH[l]),a||(a=!ze(c)||c!==this._$AH[l]),c===X?t=X:t!==X&&(t+=(c??"")+s[l+1]),this._$AH[l]=c}a&&!i&&this.j(t)}j(t){t===X?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class Yn extends nt{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===X?void 0:t}}const Xn=_e?_e.emptyScript:"";class Un extends nt{constructor(){super(...arguments),this.type=4}j(t){t&&t!==X?this.element.setAttribute(this.name,Xn):this.element.removeAttribute(this.name)}}class Kn extends nt{constructor(t,r,e,i,s){super(t,r,e,i,s),this.type=5}_$AI(t,r=this){var e;if((t=(e=Ee(this,t,r,0))!==null&&e!==void 0?e:X)===Ne)return;const i=this._$AH,s=t===X&&i!==X||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,a=t!==X&&(i===X||s);s&&this.element.removeEventListener(this.name,this,i),a&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){var r,e;typeof this._$AH=="function"?this._$AH.call((e=(r=this.options)===null||r===void 0?void 0:r.host)!==null&&e!==void 0?e:this.element,t):this._$AH.handleEvent(t)}}class jn{constructor(t,r,e){this.element=t,this.type=6,this._$AN=void 0,this._$AM=r,this.options=e}get _$AU(){return this._$AM._$AU}_$AI(t){Ee(this,t)}}const Dt=Ke.litHtmlPolyfillSupport;Dt==null||Dt(Ie,Ve),((at=Ke.litHtmlVersions)!==null&&at!==void 0?at:Ke.litHtmlVersions=[]).push("2.7.5");const Jn=(n,t,r)=>{var e,i;const s=(e=r==null?void 0:r.renderBefore)!==null&&e!==void 0?e:t;let a=s._$litPart$;if(a===void 0){const o=(i=r==null?void 0:r.renderBefore)!==null&&i!==void 0?i:null;s._$litPart$=a=new Ve(t.insertBefore(Te(),o),o,void 0,r??{})}return a._$AI(n),a};var ee=typeof window<"u"?window:null,Et=ee===null,De=Et?void 0:ee.document,ne="addEventListener",ie="removeEventListener",ot="getBoundingClientRect",Pe="_a",re="_b",oe="_c",Ge="horizontal",ae=function(){return!1},Zn=Et?"calc":["","-webkit-","-moz-","-o-"].filter(function(n){var t=De.createElement("div");return t.style.cssText="width:"+n+"calc(9px)",!!t.style.length}).shift()+"calc",hn=function(n){return typeof n=="string"||n instanceof String},Ht=function(n){if(hn(n)){var t=De.querySelector(n);if(!t)throw new Error("Selector "+n+" did not match a DOM element");return t}return n},j=function(n,t,r){var e=n[t];return e!==void 0?e:r},Ye=function(n,t,r,e){if(t){if(e==="end")return 0;if(e==="center")return n/2}else if(r){if(e==="start")return 0;if(e==="center")return n/2}return n},Qn=function(n,t){var r=De.createElement("div");return r.className="gutter gutter-"+t,r},ei=function(n,t,r){var e={};return hn(t)?e[n]=t:e[n]=Zn+"("+t+"% - "+r+"px)",e},ti=function(n,t){var r;return r={},r[n]=t+"px",r},ni=function(n,t){if(t===void 0&&(t={}),Et)return{};var r=n,e,i,s,a,o,l;Array.from&&(r=Array.from(r));var c=Ht(r[0]),d=c.parentNode,f=getComputedStyle?getComputedStyle(d):null,p=f?f.flexDirection:null,x=j(t,"sizes")||r.map(function(){return 100/r.length}),_=j(t,"minSize",100),g=Array.isArray(_)?_:r.map(function(){return _}),y=j(t,"maxSize",1/0),P=Array.isArray(y)?y:r.map(function(){return y}),L=j(t,"expandToMin",!1),z=j(t,"gutterSize",10),T=j(t,"gutterAlign","center"),B=j(t,"snapOffset",30),V=Array.isArray(B)?B:r.map(function(){return B}),q=j(t,"dragInterval",1),D=j(t,"direction",Ge),H=j(t,"cursor",D===Ge?"col-resize":"row-resize"),U=j(t,"gutter",Qn),be=j(t,"elementStyle",ei),ke=j(t,"gutterStyle",ti);D===Ge?(e="width",i="clientX",s="left",a="right",o="clientWidth"):D==="vertical"&&(e="height",i="clientY",s="top",a="bottom",o="clientHeight");function se(k,v,E,A){var N=be(e,v,E,A);Object.keys(N).forEach(function(G){k.style[G]=N[G]})}function le(k,v,E){var A=ke(e,v,E);Object.keys(A).forEach(function(N){k.style[N]=A[N]})}function Z(){return l.map(function(k){return k.size})}function ce(k){return"touches"in k?k.touches[0][i]:k[i]}function u(k){var v=l[this.a],E=l[this.b],A=v.size+E.size;v.size=k/this.size*A,E.size=A-k/this.size*A,se(v.element,v.size,this[re],v.i),se(E.element,E.size,this[oe],E.i)}function b(k){var v,E=l[this.a],A=l[this.b];this.dragging&&(v=ce(k)-this.start+(this[re]-this.dragOffset),q>1&&(v=Math.round(v/q)*q),v<=E.minSize+E.snapOffset+this[re]?v=E.minSize+this[re]:v>=this.size-(A.minSize+A.snapOffset+this[oe])&&(v=this.size-(A.minSize+this[oe])),v>=E.maxSize-E.snapOffset+this[re]?v=E.maxSize+this[re]:v<=this.size-(A.maxSize-A.snapOffset+this[oe])&&(v=this.size-(A.maxSize+this[oe])),u.call(this,v),j(t,"onDrag",ae)(Z()))}function C(){var k=l[this.a].element,v=l[this.b].element,E=k[ot](),A=v[ot]();this.size=E[e]+A[e]+this[re]+this[oe],this.start=E[s],this.end=E[a]}function S(k){if(!getComputedStyle)return null;var v=getComputedStyle(k);if(!v)return null;var E=k[o];return E===0?null:(D===Ge?E-=parseFloat(v.paddingLeft)+parseFloat(v.paddingRight):E-=parseFloat(v.paddingTop)+parseFloat(v.paddingBottom),E)}function M(k){var v=S(d);if(v===null||g.reduce(function(G,K){return G+K},0)>v)return k;var E=0,A=[],N=k.map(function(G,K){var J=v*G/100,we=Ye(z,K===0,K===k.length-1,T),qe=g[K]+we;return J<qe?(E+=qe-J,A.push(0),qe):(A.push(J-qe),J)});return E===0?k:N.map(function(G,K){var J=G;if(E>0&&A[K]-E>0){var we=Math.min(E,A[K]-E);E-=we,J=G-we}return J/v*100})}function R(){var k=this,v=l[k.a].element,E=l[k.b].element;k.dragging&&j(t,"onDragEnd",ae)(Z()),k.dragging=!1,ee[ie]("mouseup",k.stop),ee[ie]("touchend",k.stop),ee[ie]("touchcancel",k.stop),ee[ie]("mousemove",k.move),ee[ie]("touchmove",k.move),k.stop=null,k.move=null,v[ie]("selectstart",ae),v[ie]("dragstart",ae),E[ie]("selectstart",ae),E[ie]("dragstart",ae),v.style.userSelect="",v.style.webkitUserSelect="",v.style.MozUserSelect="",v.style.pointerEvents="",E.style.userSelect="",E.style.webkitUserSelect="",E.style.MozUserSelect="",E.style.pointerEvents="",k.gutter.style.cursor="",k.parent.style.cursor="",De.body.style.cursor=""}function w(k){if(!("button"in k&&k.button!==0)){var v=this,E=l[v.a].element,A=l[v.b].element;v.dragging||j(t,"onDragStart",ae)(Z()),k.preventDefault(),v.dragging=!0,v.move=b.bind(v),v.stop=R.bind(v),ee[ne]("mouseup",v.stop),ee[ne]("touchend",v.stop),ee[ne]("touchcancel",v.stop),ee[ne]("mousemove",v.move),ee[ne]("touchmove",v.move),E[ne]("selectstart",ae),E[ne]("dragstart",ae),A[ne]("selectstart",ae),A[ne]("dragstart",ae),E.style.userSelect="none",E.style.webkitUserSelect="none",E.style.MozUserSelect="none",E.style.pointerEvents="none",A.style.userSelect="none",A.style.webkitUserSelect="none",A.style.MozUserSelect="none",A.style.pointerEvents="none",v.gutter.style.cursor=H,v.parent.style.cursor=H,De.body.style.cursor=H,C.call(v),v.dragOffset=ce(k)-v.end}}x=M(x);var $=[];l=r.map(function(k,v){var E={element:Ht(k),size:x[v],minSize:g[v],maxSize:P[v],snapOffset:V[v],i:v},A;if(v>0&&(A={a:v-1,b:v,dragging:!1,direction:D,parent:d},A[re]=Ye(z,v-1===0,!1,T),A[oe]=Ye(z,!1,v===r.length-1,T),p==="row-reverse"||p==="column-reverse")){var N=A.a;A.a=A.b,A.b=N}if(v>0){var G=U(v,D,E.element);le(G,z,v),A[Pe]=w.bind(A),G[ne]("mousedown",A[Pe]),G[ne]("touchstart",A[Pe]),d.insertBefore(G,E.element),A.gutter=G}return se(E.element,E.size,Ye(z,v===0,v===r.length-1,T),v),v>0&&$.push(A),E});function I(k){var v=k.i===$.length,E=v?$[k.i-1]:$[k.i];C.call(E);var A=v?E.size-k.minSize-E[oe]:k.minSize+E[re];u.call(E,A)}l.forEach(function(k){var v=k.element[ot]()[e];v<k.minSize&&(L?I(k):k.minSize=v)});function Y(k){var v=M(k);v.forEach(function(E,A){if(A>0){var N=$[A-1],G=l[N.a],K=l[N.b];G.size=v[A-1],K.size=E,se(G.element,G.size,N[re],G.i),se(K.element,K.size,N[oe],K.i)}})}function te(k,v){$.forEach(function(E){if(v!==!0?E.parent.removeChild(E.gutter):(E.gutter[ie]("mousedown",E[Pe]),E.gutter[ie]("touchstart",E[Pe])),k!==!0){var A=be(e,E.a.size,E[re]);Object.keys(A).forEach(function(N){l[E.a].element.style[N]="",l[E.b].element.style[N]=""})}})}return{setSizes:Y,getSizes:Z,collapse:function(v){I(l[v])},destroy:te,parent:d,pairs:$}};class W{constructor(t,r,e){this.width=t,this.height=r,this.pixels=new Uint8ClampedArray(e)}static fromJSON(t){return new W(t.width,t.height,t.pixels)}static empty(t,r,e){let i=new Array(t*r).fill(e);return new W(t,r,i)}static fromTile(t,r,e){let i=[];for(let s=0;s<r;s++)for(let a=0;a<t;a++)i.push(e.pixel(a%e.width,s%e.height));return new W(t,r,i)}overlay(t,r){const e=[];for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++)e.push({x:r[0]+s,y:r[1]+t.height-i-1,color:t.pixel(s,i)});return this.draw(e)}toJSON(){return{pixels:Array.from(this.pixels),width:this.width,height:this.height}}pad(t,r,e){const i=Array(r*(this.width+2*t)).fill(e),s=Array(t).fill(e);let a=this.make2d();return new W(this.width+2*t,this.height+2*r,[...a.reduce((o,l)=>[...o,...s,...l,...s],[...i]),...i])}resize(t,r,e=0){let i=[];for(let s=0;s<r;s++)for(let a=0;a<t;a++)s>=this.height||a>=this.width?i.push(e):i.push(this.pixel(a,s));return new W(t,r,i)}make2d(){let t=Array.from(this.pixels).slice(),r=[];for(;t.length>0;)r.push(t.splice(0,this.width));return r}vMirror(){return new W(this.width,this.height,this.make2d().toReversed().flat())}vFlip(){return new W(this.width,this.height,this.make2d().toReversed().flat())}pixel(t,r){return t>this.width-1||t<0||r>this.height-1||r<0?-1:this.pixels.at(t+r*this.width)}draw(t){let r=this.pixels.slice();for(let{x:e,y:i,color:s}of t)e<0||i<0||e>=this.width||i>=this.height||(r[e+i*this.width]=s);return new W(this.width,this.height,r)}brush({x:t,y:r},e){let i={x:t,y:r,color:e};return this.draw([i])}flood({x:t,y:r},e){const i=this.pixel(t,r);if(i===e)return this.draw([]);const s=[{dx:-1,dy:0},{dx:1,dy:0},{dx:0,dy:-1},{dx:0,dy:1}];let a=[{x:t,y:r,color:e}];for(let o=0;o<a.length;o++)for(let{dx:l,dy:c}of s){let d=a[o].x+l,f=a[o].y+c;d>=0&&d<this.width&&f>=0&&f<this.height&&this.pixel(d,f)==i&&!a.some(p=>p.x==d&&p.y==f)&&a.push({x:d,y:f,color:e})}return this.draw(a)}shift(t,r){let e=[];for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)e.push({x:(s-t%this.width+this.width)%this.width,y:(i-r%this.height+this.height)%this.height,color:this.pixel(s,i)});return this.draw(e)}rect(t,r,e){let i=Math.min(t.x,r.x),s=Math.min(t.y,r.y),a=Math.max(t.x,r.x),o=Math.max(t.y,r.y),l=[];for(let c=s;c<=o;c++)for(let d=i;d<=a;d++)l.push({x:d,y:c,color:e});return this.draw(l)}line(t,r,e){let i=[];if(Math.abs(t.x-r.x)>Math.abs(t.y-r.y)){t.x>r.x&&([t,r]=[r,t]);let s=(r.y-t.y)/(r.x-t.x);for(let{x:a,y:o}=t;a<=r.x;a++)i.push({x:a,y:Math.round(o),color:e}),o+=s}else{t.y>r.y&&([t,r]=[r,t]);let s=(r.x-t.x)/(r.y-t.y);for(let{x:a,y:o}=t;o<=r.y;o++)i.push({x:Math.round(a),y:o,color:e}),a+=s}return this.draw(i)}}const ii="modulepreload",ri=function(n){return"/"+n},Ft={},Q=function(t,r,e){if(!r||r.length===0)return t();const i=document.getElementsByTagName("link");return Promise.all(r.map(s=>{if(s=ri(s),s in Ft)return;Ft[s]=!0;const a=s.endsWith(".css"),o=a?'[rel="stylesheet"]':"";if(!!e)for(let d=i.length-1;d>=0;d--){const f=i[d];if(f.href===s&&(!a||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${o}`))return;const c=document.createElement("link");if(c.rel=a?"stylesheet":ii,a||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),a)return new Promise((d,f)=>{c.addEventListener("load",d),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>t()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},un=100,dn=5,fn=6,pn=.6,ai=1e3,gn=["yarnPalette","yarnSequence","repeats"],St={knit:new Path2D("M 0 0.5 L 0.4 0.5 C 0.7 0.5 0.7 0.2 0.5 0.2 C 0.3 0.2 0.3 0.5 0.6 0.5 L 1 0.5"),purl:new Path2D("M 1 0.5 L 0.6 0.5 C 0.3 0.5 0.3 0.8 0.5 0.8 C 0.7 0.8 0.7 0.5 0.4 0.5 L 0 0.5"),slip:new Path2D("M 0 0.5 L 1 0.5"),tuck:new Path2D("M 0 0.5 L 0.2 0.5 C 0.3 0.5 0.35 0.5 0.4 0.45 C 0.45 0.4 0.4 0.2 0.5 0.2 C 0.6 0.2 0.55 0.4 0.6 0.45 C 0.65 0.5 0.7 0.5 0.8 0.5 L 1 0.5")},vn={knit:!1,purl:!1,slip:!0,tuck:!0},si=["knit","purl","slip","tuck"],oi=Object.assign({"../examples/basketweave.json":()=>Q(()=>import("./basketweave-906b493c.js"),[]),"../examples/beetles.json":()=>Q(()=>import("./beetles-dc304062.js"),[]),"../examples/birds.json":()=>Q(()=>import("./birds-cffbe870.js"),[]),"../examples/hex quilt.json":()=>Q(()=>import("./hex quilt-2aad3053.js"),[]),"../examples/hourglass.json":()=>Q(()=>import("./hourglass-9147f45f.js"),[]),"../examples/interblocks.json":()=>Q(()=>import("./interblocks-abbf4bcd.js"),[]),"../examples/pseudoweave.json":()=>Q(()=>import("./pseudoweave-1e31fd31.js"),[]),"../examples/pseudoweave_wool.json":()=>Q(()=>import("./pseudoweave_wool-4178420c.js"),[]),"../examples/pyramids (slip).json":()=>Q(()=>import("./pyramids (slip)-946fcb7f.js"),[]),"../examples/pyramids (tuck).json":()=>Q(()=>import("./pyramids (tuck)-2fa93fbf.js"),[]),"../examples/squargets.json":()=>Q(()=>import("./squargets-d2284441.js"),[]),"../examples/sunset dots.json":()=>Q(()=>import("./sunset dots-c1dd1035.js"),[])}),mn={brush:{icon:"fa-solid fa-paintbrush",hotkey:"b"},flood:{icon:"fa-solid fa-fill-drip fa-flip-horizontal",hotkey:"f"},rect:{icon:"fa-solid fa-vector-square",hotkey:"r"},line:{icon:"fa-solid fa-minus",hotkey:"l"},shift:{icon:"fa-solid fa-right-left",hotkey:"s"},move:{hotkey:"h"}};let h={editingPalette:!1,transforming:!1,activeTool:"brush",activeSymbol:0,chartBackground:"#ffffff",symbolPalette:{},symbolMap:si,patternLibrary:oi,scale:15,pos:{x:-1,y:-1},chartPan:{x:0,y:0},simScale:1,simPan:{x:0,y:0},activeYarn:0,yarnPalette:["rgba(16,18,189,1)","rgba(235,233,187,1)"],yarnSequence:new W(1,4,[0,0,1,1]),editingRepeat:-1,repeatPos:[-1,-1],repeats:[{bitmap:new W(24,20,[0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,3,0,3,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,3,0,2,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,0,3,0,2,0,0,0,0,0,0,0,0,0,3,0,3,0,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,0,3,0,3,0,3,0,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,0,3,0,3,0,3,0,3,0,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0,3,0,3,0,3,0,3,0,3,0,0,0]),pos:[0,0],area:[48,60]}],repeatLibrary:[{title:"blank",bitmap:new W(2,2,[0,0,0,0])},{title:"checks",bitmap:new W(2,2,[0,2,2,0])},{title:"stripe",bitmap:new W(2,2,[0,2,0,2])}],chart:W.empty(48,60,0),reverseScroll:!1,grid:!0,symbolLineWidth:3,flipped:!1,showLibrary:!1,showSettings:!1,showDownload:!1,showRepeatLibrary:!1,debug:!1,snapshots:[],lastSnapshot:0,heldKeys:new Set};function li(n){if(!(h.lastSnapshot<Date.now()-ai))return!1;for(const t of gn)if(t in n)return!0;return!1}function ci(n){return h={...h,...n,snapshots:[Object.fromEntries(gn.map(t=>[t,h[t]])),...h.snapshots],lastSnapshot:Date.now()},h}function hi(n){return h={...h,...n},h}function ui(n){return li(n)?ci(n):hi(n)}function yn(){if(h.snapshots.length<1)return;const n=Object.keys(h.snapshots[0]);h={...h,...h.snapshots[0],lastSnapshot:0,snapshots:h.snapshots.slice(1)},kt.syncState(h,n)}function m(n){const t=Object.keys(n);kt.syncState(ui(n),t)}const kt=(()=>{const n=[];function t(e,i){n.forEach(s=>{s.syncState(e,i)})}function r(e){e.forEach(i=>n.push(i({state:h,dispatch:m})))}return{register:r,syncState:t}})();var F={};F.render=function(n,t,r){if(typeof n=="string"&&(n=document.getElementById(n)),!n||!n.tagName)throw"bmp_lib.render: Invalid element: "+n;if(n.tagName=="IMG")n.src=this.imageSource(t,r);else if(n.tagName=="TABLE"){var e=this.tableBody(t,r);if("outerHTML"in n){for(var i=n.rows.length,s=i-1;s>=0;s--)n.deleteRow(s);var a=n.outerHTML;a=a.substring(0,a.indexOf(">")+1);var o=document.createElement("DIV");o.innerHTML=a+e+"</table>",n.parentElement.replaceChild(o.firstChild,n)}else n.innerHTML=e}else throw"bmp_lib.render: Invalid HTML tag: "+n.tagName};F.imageSource=function(n,t){var r=this.normalize_(n,t),e=this.createBmp_(r[0],r[1]);return"data:image/bmp;base64,"+this.encode64_(e)};F.tableBody=function(n,t){var r=this.normalize_(n,t);n=r[0];for(var e=r[1],i=n.length,s=i&&n[0].length,a,o=[],l=0;l<i;l++){row=[];for(var c=0;c<s;c++){e?a=e[n[l].charCodeAt(c)]:a=n[l][c];var d=this.dec2hex_(a[0])+this.dec2hex_(a[1])+this.dec2hex_(a[2]);row[c]="<TD BGCOLOR=#"+d+"><img width=1 height=1></TD>"}row.unshift("<TR>"),row.push("</TR>"),o[l]=row.join("")}return o.join(`
`)};F.normalize_=function(n,t){var r;if(n.length==0)r=null;else if(typeof n[0]=="string"&&t)r=t;else if(typeof n[0]=="object"&&typeof n[0][0]=="number"&&t)n=this.arrayArrayToArrayStr_(n),r=t;else if(typeof n[0]=="object"&&typeof n[0][0]=="object"&&n[0][0].length>=3)r=null;else throw"Invalid argument types.";return[n,r]};F.createBmp_=function(n,t){var r="BMxxxx\0\0\0\0yyyy",e=n.length,i=e&&n[0].length,s=this.multiByteEncode_(e,4),a=this.multiByteEncode_(i,4),o=this.multiByteEncode_(40,4),l;t&&t.length<=256?l=8:(l=24,t&&(n=this.depalette_(n,t)),t=null);var c=this.multiByteEncode_(l,2),d=o+a+s+"\0"+c+"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0",f;if(l!=24){var p=String(t);if(F.createBmp_.palette_str_cache==p)f=F.createBmp_.rgbQuad_cache;else{f=[];for(var x=0,_=0,g=0,y=0;y<256;y++)y<t.length&&(x=t[y][0],_=t[y][1],g=t[y][2]),f[y]=String.fromCharCode(g,_,x,0);f=f.join(""),F.createBmp_.palette_str_cache=p,F.createBmp_.rgbQuad_cache=f}}else f="";var P;i%4==1?P="\0\0\0":i%4==2?P="\0\0":i%4==3?P="\0":P="",l==24&&(P=P+P+P);for(var L=[],z=0;z<e;z++){var T=n[e-z-1];if(l==8)L[z]=T+P;else if(l==24){for(var y=0;y<i;y++)L.push(String.fromCharCode(T[y][2],T[y][1],T[y][0]));L.push(P)}}L=L.join("");var B=r+d+f+L;return B=B.replace(/yyyy/,this.multiByteEncode_(r.length+d.length+f.length,4)),B=B.replace(/xxxx/,this.multiByteEncode_(B.length,4)),B};F.createBmp_.palette_str_cache="";F.createBmp_.rgbQuad_cache="";F.multiByteEncode_=function(n,t){if(n<0||t<0)throw"Negative numbers not allowed.";for(var r="",e=0;e<t;e++)r+=String.fromCharCode(n&255),n=n>>8;if(n!=0)throw"Overflow, number too big for string length";return r};F.arrayArrayToArrayStr_=function(n){for(var t=Array(n.length),r=0;r<n.length;r++){let i=[];for(var e=0;e<n[r].length;e++)i[e]=String.fromCharCode(n[r][e]);t[r]=i.join("")}return t};F.depalette_=function(n,t){for(var r=Array(n.length),e=0;e<n.length;e++){r[e]=[];for(var i=0;i<n[e].length;i++)r[e][i]=t[n[e].charCodeAt(i)]}return r};F.dec2hex_=function(n){var t=n%16,r=(n-t)/16;return F.dec2hex_.hexChars.charAt(r)+F.dec2hex_.hexChars.charAt(t)};F.dec2hex_.hexChars="0123456789ABCDEF";F.encode64_=function(n){var t="",r=0;do{var e=n.charCodeAt(r++),i=n.charCodeAt(r++),s=n.charCodeAt(r++),a=e>>2,o=(e&3)<<4|i>>4,l=(i&15)<<2|s>>6,c=s&63;isNaN(i)?l=c=64:isNaN(s)&&(c=64),t=t+F.encode64_.keyStr.charAt(a)+F.encode64_.keyStr.charAt(o)+F.encode64_.keyStr.charAt(l)+F.encode64_.keyStr.charAt(c)}while(r<n.length);return t};F.encode64_.keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";"btoa"in window&&typeof window.btoa=="function"&&window.btoa("hello")=="aGVsbG8="&&(F.encode64_=function(n){return window.btoa(n)});function di(n){const t=n.getBoundingClientRect();return{width:t.width*devicePixelRatio,height:t.height*devicePixelRatio}}function je(n,t){const r=t.getBoundingClientRect(),e=Math.floor((n.clientX-r.x)/h.scale*devicePixelRatio),i=Math.floor((n.clientY-r.y)/h.scale*devicePixelRatio);return{x:e,y:h.yarnSequence.height-i-1}}function ue(n,t){const r=t.getBoundingClientRect(),e=Math.floor((n.clientX-r.x)/h.scale*devicePixelRatio),i=Math.floor((n.clientY-r.y)/h.scale*devicePixelRatio);return{x:e,y:i}}function Je(){const n="0123456789ABCDEF";let t="#";for(let r=0;r<6;r++)t+=n[Math.floor(Math.random()*16)];return t}function We(n,t){const r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",t),document.body.appendChild(r),r.click(),r.remove()}function fi(){let n=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(n=!0)}(navigator.userAgent||navigator.vendor||window.opera),n}function pi(n,t){let r=n>t?n:t;for(;;){if(r%n==0&&r%t==0)return r;r++}}function gi(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function vi(n){return n.sort(()=>Math.random()>.5?1:-1)}function mi(n,t,r){const e=pi(n.height,t.length),i=n.make2d(),s=[];for(let l=0;l<e;l++)s.push(i[l%n.height].map(c=>c==0||c==1?t[l%t.length]:r.length));const a=r.map(l=>gi(l));a.push([255,255,255]);const o=document.createElement("img");return F.render(o,s,a),o}function yi(){var n=window.document,t=n.documentElement,r=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,e=n.exitFullscreen||n.mozCancelFullScreen||n.webkitExitFullscreen||n.msExitFullscreen;!n.fullscreenElement&&!n.mozFullScreenElement&&!n.webkitFullscreenElement&&!n.msFullscreenElement?r.call(t):e.call(n)}function lt(n){let t=document.getElementById("desktop").getBoundingClientRect();wn({x:t.width/2,y:t.height/2},n)}function ct(n){let t=document.getElementById("sim-container").getBoundingClientRect();bn({x:t.width/2,y:t.height/2},n)}function bn(n,t){if(t<pn||t>fn)return;const r={x:(n.x-h.simPan.x)/h.simScale,y:(n.y-h.simPan.y)/h.simScale};m({simScale:t,simPan:{x:n.x-r.x*t,y:n.y-r.y*t}})}function wn(n,t){if(t<dn||t>un)return;const r={x:(n.x-h.chartPan.x)/h.scale,y:(n.y-h.chartPan.y)/h.scale};m({scale:t,chartPan:{x:n.x-r.x*t,y:n.y-r.y*t}})}function it(){const{width:n,height:t}=di(document.getElementById("desktop")),r=Math.floor(.9*Math.min(Math.floor(n/h.chart.width),Math.floor(t/h.chart.height)));m({scale:r,chartPan:{x:(n-r*h.chart.width)/2/devicePixelRatio,y:(t-r*h.chart.height)/2/devicePixelRatio}})}function Ze(n,t,r){n.width=h.scale*t,n.height=h.scale*r,n.style.width=`${h.scale*t/devicePixelRatio}px`,n.style.height=`${h.scale*r/devicePixelRatio}px`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function ge(n,t,r){return n?t():r==null?void 0:r()}function xn(n){let{yarnSequence:t,yarnPalette:r,repeats:e,width:i,height:s}=n;m({yarnPalette:r,width:i,height:s,yarnSequence:W.fromJSON(t),chart:W.empty(i,s,0),repeats:e.map(({bitmap:a,pos:o,area:l})=>({bitmap:W.fromJSON(a),pos:o,area:l}))}),it()}function bi(){m({repeats:[],yarnSequence:new W(1,4,[0,0,1,1]),yarnPalette:[Je(),Je()],chart:W.empty(30,40,0),repeats:[{bitmap:new W(4,4,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),area:[30,40],pos:[0,0]}]}),it()}function wi(n){m({showLibrary:!1}),h.patternLibrary[n]().then(t=>xn(t))}function xi(){let n=document.createElement("input");n.setAttribute("type","file"),n.style.display="none",document.body.appendChild(n),n.click(),n.onchange=t=>{let r=t.target.files[0];const e=new FileReader;e.readAsText(r),e.onload=()=>{xn(JSON.parse(e.result))}},document.body.removeChild(n)}function _i(n){n=n>500?500:n,m({chart:h.chart.resize(n,h.chart.height)}),fitChart()}function Ei(n){n=n>500?500:n,m({chart:h.chart.resize(h.chart.width,n)}),fitChart()}function Si(){return O`<div id="taskbar">
    <h1 class="site-title">KnitScape</h1>
    <div id="chart-size-controls">
      <label>Width</label>
      <input
        class="input"
        type="number"
        .value=${h.chart.width}
        @change=${n=>_i(Number(n.target.value))}
        min="5"
        max="1000" />
      <label>Height</label>
      <input
        class="input"
        type="number"
        .value=${h.chart.height}
        @change=${n=>Ei(Number(n.target.value))}
        min="5"
        max="1000" />
    </div>
    <div class="taskbar-buttons">
      <button class="btn icon" @click=${()=>yn()}>
        <i class="fa-solid fa-rotate-left"></i>
      </button>
      <button class="btn icon" @click=${()=>bi()}>
        <i class="fa-solid fa-file"></i>
      </button>
      <button class="btn icon" @click=${()=>xi()}>
        <i class="fa-solid fa-upload"></i>
      </button>
      <button class="btn icon" @click=${()=>m({showDownload:!0})}>
        <i class="fa-solid fa-download"></i>
      </button>
      <button
        class="btn icon ${h.showLibrary?"open":""}"
        @click=${()=>m({showLibrary:!h.showLibrary})}>
        <i class="fa-solid fa-book"></i>
      </button>
      <button
        class="btn icon ${h.showSettings?"open":""}"
        @click=${()=>m({showSettings:!h.showSettings})}>
        <i class="fa-solid fa-gear"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>window.open("https://github.com/branchwelder/knitscape")}>
        <i class="fa-brands fa-github"></i>
      </button>

      <button class="btn icon" @click=${()=>yi()}>
        <i
          class="fa-solid fa-${!window.document.fullscreenElement&&!window.document.mozFullScreenElement&&!window.document.webkitFullscreenElement&&!window.document.msFullscreenElement?"up-right-and-down-left-from-center":"down-left-and-up-right-to-center"}"></i>
      </button>
    </div>
  </div>`}function ki(){const n=document.getElementById("simulation");let r=new XMLSerializer().serializeToString(n);r.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(r=r.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),r.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(r=r.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),r=`<?xml version="1.0" standalone="no"?>\r
`+r,We("data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r),"swatch.svg")}function Ci(){We(document.getElementById("preview").toDataURL("image/png"),"chart.png")}function Pi(){We(mi(h.repeatBitmap,h.colorSequence.pixels,h.yarnPalette).src)}function Ai(){const n=`SilverKnit
`+h.chart.make2d().map(t=>t.map(r=>r==0||r==1?7:8).join("")).join(`
`);We("data:text/plain;charset=utf-8,"+encodeURIComponent(n),"pattern.txt")}function $i(){const n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({width:h.chart.width,height:h.chart.height,repeats:h.repeats.map(({bitmap:t,pos:r,area:e})=>({bitmap:t.toJSON(),pos:r,area:e})),yarnPalette:h.yarnPalette,yarnSequence:h.yarnSequence.toJSON()}));We(n,"pattern.json")}function Li(){return O` <div class="modal">
    <h2>Download Pattern</h2>
    <div class="modal-content">
      <button class="btn solid" @click=${()=>$i()}>
        Pattern JSON
      </button>
      <button class="btn solid" @click=${()=>Ci()}>Chart PNG</button>
      <button class="btn solid" @click=${()=>ki()}>
        Simulation SVG
      </button>
      <button class="btn solid" @click=${()=>Pi()}>
        Windows BMP (Silver Knit)
      </button>
      <button class="btn solid" @click=${()=>Ai()}>
        TXT (Silver Knit)
      </button>
    </div>
  </div>`}function Mi(){return O` <div id="library-modal" class="modal">
    <h2>Pattern Library</h2>
    <div class="modal-content">
      ${Object.entries(h.patternLibrary).map(([n,t])=>O`<div class="library-item">
            <span>${n.split("/").at(-1).split(".")[0]}</span>
            <button class="btn solid" @click=${()=>wi(n)}>
              <i class="fa-solid fa-upload"></i>
            </button>
          </div>`)}
    </div>
  </div>`}var Bi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ri(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var _n={exports:{}};/**
 * jscolor - JavaScript Color Picker
 *
 * @link    http://jscolor.com
 * @license For open source use: GPLv3
 *          For commercial use: JSColor Commercial License
 * @author  Jan Odvarko - East Desire
 *
 * See usage examples at http://jscolor.com/examples/
 */(function(n){(function(t,r){{n.exports=t.document?r(t):function(e){if(!e.document)throw new Error("jscolor needs a window with document");return r(e)};return}})(typeof window<"u"?window:Bi,function(t){var r=function(){var e={initialized:!1,instances:[],readyQueue:[],register:function(){typeof t<"u"&&t.document&&t.document.addEventListener("DOMContentLoaded",e.pub.init,!1)},installBySelector:function(i,s){if(s=s?e.node(s):t.document,!s)throw new Error("Missing root node");for(var a=s.querySelectorAll(i),o=new RegExp("(^|\\s)("+e.pub.lookupClass+")(\\s*(\\{[^}]*\\})|\\s|$)","i"),l=0;l<a.length;l+=1)if(!(a[l].jscolor&&a[l].jscolor instanceof e.pub)&&!(a[l].type!==void 0&&a[l].type.toLowerCase()=="color"&&e.isColorAttrSupported)){var c,d;if((c=e.getDataAttr(a[l],"jscolor"))!==null||a[l].className&&(d=a[l].className.match(o))){var f=a[l],p="";c!==null?p=c:d&&(console.warn('Installation using class name is DEPRECATED. Use data-jscolor="" attribute instead.'+e.docsRef),d[4]&&(p=d[4]));var x=null;if(p.trim())try{x=e.parseOptionsStr(p)}catch(_){console.warn(_+`
`+p)}try{new e.pub(f,x)}catch(_){console.warn(_)}}}},parseOptionsStr:function(i){var s=null;try{s=JSON.parse(i)}catch(a){if(e.pub.looseJSON)try{s=new Function("var opts = ("+i+'); return typeof opts === "object" ? opts : {};')()}catch(o){throw new Error("Could not evaluate jscolor options: "+o)}else throw new Error("Could not parse jscolor options as JSON: "+a)}return s},getInstances:function(){for(var i=[],s=0;s<e.instances.length;s+=1)e.instances[s]&&e.instances[s].targetElement&&i.push(e.instances[s]);return i},createEl:function(i){var s=t.document.createElement(i);return e.setData(s,"gui",!0),s},node:function(i){if(!i)return null;if(typeof i=="string"){var s=i,a=null;try{a=t.document.querySelector(s)}catch(o){return console.warn(o),null}return a||console.warn("No element matches the selector: %s",s),a}return e.isNode(i)?i:(console.warn("Invalid node of type %s: %s",typeof i,i),null)},isNode:function(i){return typeof Node=="object"?i instanceof Node:i&&typeof i=="object"&&typeof i.nodeType=="number"&&typeof i.nodeName=="string"},nodeName:function(i){return i&&i.nodeName?i.nodeName.toLowerCase():!1},removeChildren:function(i){for(;i.firstChild;)i.removeChild(i.firstChild)},isTextInput:function(i){return i&&e.nodeName(i)==="input"&&i.type.toLowerCase()==="text"},isButton:function(i){if(!i)return!1;var s=e.nodeName(i);return s==="button"||s==="input"&&["button","submit","reset"].indexOf(i.type.toLowerCase())>-1},isButtonEmpty:function(i){switch(e.nodeName(i)){case"input":return!i.value||i.value.trim()==="";case"button":return i.textContent.trim()===""}return null},isPassiveEventSupported:function(){var i=!1;try{var s=Object.defineProperty({},"passive",{get:function(){i=!0}});t.addEventListener("testPassive",null,s),t.removeEventListener("testPassive",null,s)}catch{}return i}(),isColorAttrSupported:function(){var i=t.document.createElement("input");return!!(i.setAttribute&&(i.setAttribute("type","color"),i.type.toLowerCase()=="color"))}(),dataProp:"_data_jscolor",setData:function(){var i=arguments[0];if(arguments.length===3){var s=i.hasOwnProperty(e.dataProp)?i[e.dataProp]:i[e.dataProp]={},a=arguments[1],o=arguments[2];return s[a]=o,!0}else if(arguments.length===2&&typeof arguments[1]=="object"){var s=i.hasOwnProperty(e.dataProp)?i[e.dataProp]:i[e.dataProp]={},l=arguments[1];for(var a in l)l.hasOwnProperty(a)&&(s[a]=l[a]);return!0}throw new Error("Invalid arguments")},removeData:function(){var i=arguments[0];if(!i.hasOwnProperty(e.dataProp))return!0;for(var s=1;s<arguments.length;s+=1){var a=arguments[s];delete i[e.dataProp][a]}return!0},getData:function(i,s,a){if(!i.hasOwnProperty(e.dataProp))if(a!==void 0)i[e.dataProp]={};else return;var o=i[e.dataProp];return!o.hasOwnProperty(s)&&a!==void 0&&(o[s]=a),o[s]},getDataAttr:function(i,s){var a="data-"+s,o=i.getAttribute(a);return o},setDataAttr:function(i,s,a){var o="data-"+s;i.setAttribute(o,a)},_attachedGroupEvents:{},attachGroupEvent:function(i,s,a,o){e._attachedGroupEvents.hasOwnProperty(i)||(e._attachedGroupEvents[i]=[]),e._attachedGroupEvents[i].push([s,a,o]),s.addEventListener(a,o,!1)},detachGroupEvents:function(i){if(e._attachedGroupEvents.hasOwnProperty(i)){for(var s=0;s<e._attachedGroupEvents[i].length;s+=1){var a=e._attachedGroupEvents[i][s];a[0].removeEventListener(a[1],a[2],!1)}delete e._attachedGroupEvents[i]}},preventDefault:function(i){i.preventDefault&&i.preventDefault(),i.returnValue=!1},triggerEvent:function(i,s,a,o){if(i){var l=null;return typeof Event=="function"?l=new Event(s,{bubbles:a,cancelable:o}):(l=t.document.createEvent("Event"),l.initEvent(s,a,o)),l?(e.setData(l,"internal",!0),i.dispatchEvent(l),!0):!1}},triggerInputEvent:function(i,s,a,o){i&&e.isTextInput(i)&&e.triggerEvent(i,s,a,o)},eventKey:function(i){var s={9:"Tab",13:"Enter",27:"Escape"};return typeof i.code=="string"?i.code:i.keyCode!==void 0&&s.hasOwnProperty(i.keyCode)?s[i.keyCode]:null},strList:function(i){return i?i.replace(/^\s+|\s+$/g,"").split(/\s+/):[]},hasClass:function(i,s){return s?i.classList!==void 0?i.classList.contains(s):(" "+i.className.replace(/\s+/g," ")+" ").indexOf(" "+s+" ")!=-1:!1},addClass:function(i,s){var a=e.strList(s);if(i.classList!==void 0){for(var o=0;o<a.length;o+=1)i.classList.add(a[o]);return}for(var o=0;o<a.length;o+=1)e.hasClass(i,a[o])||(i.className+=(i.className?" ":"")+a[o])},removeClass:function(i,s){var a=e.strList(s);if(i.classList!==void 0){for(var o=0;o<a.length;o+=1)i.classList.remove(a[o]);return}for(var o=0;o<a.length;o+=1){var l=new RegExp("^\\s*"+a[o]+"\\s*|\\s*"+a[o]+"\\s*$|\\s+"+a[o]+"(\\s+)","g");i.className=i.className.replace(l,"$1")}},getCompStyle:function(i){var s=t.getComputedStyle?t.getComputedStyle(i):i.currentStyle;return s||{}},setStyle:function(i,s,a,o){var l=a?"important":"",c=null;for(var d in s)if(s.hasOwnProperty(d)){var f=null;s[d]===null?(c||(c=e.getData(i,"origStyle")),c&&c.hasOwnProperty(d)&&(f=c[d])):(o&&(c||(c=e.getData(i,"origStyle",{})),c.hasOwnProperty(d)||(c[d]=i.style[d])),f=s[d]),f!==null&&i.style.setProperty(d,f,l)}},appendCss:function(i){var s=document.querySelector("head"),a=document.createElement("style");a.innerText=i,s.appendChild(a)},appendDefaultCss:function(i){e.appendCss([".jscolor-wrap, .jscolor-wrap div, .jscolor-wrap canvas { position:static; display:block; visibility:visible; overflow:visible; margin:0; padding:0; border:none; border-radius:0; outline:none; z-index:auto; float:none; width:auto; height:auto; left:auto; right:auto; top:auto; bottom:auto; min-width:0; min-height:0; max-width:none; max-height:none; background:none; clip:auto; opacity:1; transform:none; box-shadow:none; box-sizing:content-box; }",".jscolor-wrap { clear:both; }",".jscolor-wrap .jscolor-picker { position:relative; }",".jscolor-wrap .jscolor-shadow { position:absolute; left:0; top:0; width:100%; height:100%; }",".jscolor-wrap .jscolor-border { position:relative; }",".jscolor-wrap .jscolor-palette { position:absolute; }",".jscolor-wrap .jscolor-palette-sw { position:absolute; display:block; cursor:pointer; }",".jscolor-wrap .jscolor-btn { position:absolute; overflow:hidden; white-space:nowrap; font:13px sans-serif; text-align:center; cursor:pointer; }"].join(`
`))},hexColor:function(i,s,a){return"#"+(("0"+Math.round(i).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)).toUpperCase()},hexaColor:function(i,s,a,o){return"#"+(("0"+Math.round(i).toString(16)).slice(-2)+("0"+Math.round(s).toString(16)).slice(-2)+("0"+Math.round(a).toString(16)).slice(-2)+("0"+Math.round(o*255).toString(16)).slice(-2)).toUpperCase()},rgbColor:function(i,s,a){return"rgb("+Math.round(i)+","+Math.round(s)+","+Math.round(a)+")"},rgbaColor:function(i,s,a,o){return"rgba("+Math.round(i)+","+Math.round(s)+","+Math.round(a)+","+Math.round((o??1)*100)/100+")"},linearGradient:function(){function i(){for(var a="linear-gradient",o=["","-webkit-","-moz-","-o-","-ms-"],l=t.document.createElement("div"),c=0;c<o.length;c+=1){var d=o[c]+a,f=d+"(to right, rgba(0,0,0,0), rgba(0,0,0,0))";if(l.style.background=f,l.style.background)return d}return a}var s=i();return function(){return s+"("+Array.prototype.join.call(arguments,", ")+")"}}(),setBorderRadius:function(i,s){e.setStyle(i,{"border-radius":s||"0"})},setBoxShadow:function(i,s){e.setStyle(i,{"box-shadow":s||"none"})},getElementPos:function(i,s){var a=0,o=0,l=i.getBoundingClientRect();if(a=l.left,o=l.top,!s){var c=e.getViewPos();a+=c[0],o+=c[1]}return[a,o]},getElementSize:function(i){return[i.offsetWidth,i.offsetHeight]},getAbsPointerPos:function(i){var s=0,a=0;return typeof i.changedTouches<"u"&&i.changedTouches.length?(s=i.changedTouches[0].clientX,a=i.changedTouches[0].clientY):typeof i.clientX=="number"&&(s=i.clientX,a=i.clientY),{x:s,y:a}},getRelPointerPos:function(i){var s=i.target||i.srcElement,a=s.getBoundingClientRect(),o=0,l=0,c=0,d=0;return typeof i.changedTouches<"u"&&i.changedTouches.length?(c=i.changedTouches[0].clientX,d=i.changedTouches[0].clientY):typeof i.clientX=="number"&&(c=i.clientX,d=i.clientY),o=c-a.left,l=d-a.top,{x:o,y:l}},getViewPos:function(){var i=t.document.documentElement;return[(t.pageXOffset||i.scrollLeft)-(i.clientLeft||0),(t.pageYOffset||i.scrollTop)-(i.clientTop||0)]},getViewSize:function(){var i=t.document.documentElement;return[t.innerWidth||i.clientWidth,t.innerHeight||i.clientHeight]},RGB_HSV:function(i,s,a){i/=255,s/=255,a/=255;var o=Math.min(Math.min(i,s),a),l=Math.max(Math.max(i,s),a),c=l-o;if(c===0)return[null,0,100*l];var d=i===o?3+(a-s)/c:s===o?5+(i-a)/c:1+(s-i)/c;return[60*(d===6?0:d),100*(c/l),100*l]},HSV_RGB:function(i,s,a){var o=255*(a/100);if(i===null)return[o,o,o];i/=60,s/=100;var l=Math.floor(i),c=l%2?i-l:1-(i-l),d=o*(1-s),f=o*(1-s*c);switch(l){case 6:case 0:return[o,f,d];case 1:return[f,o,d];case 2:return[d,o,f];case 3:return[d,f,o];case 4:return[f,d,o];case 5:return[o,d,f]}},parseColorString:function(i){var s={rgba:null,format:null},a;if(a=i.match(/^\W*([0-9A-F]{3,8})\W*$/i)){if(a[1].length===8)s.format="hexa",s.rgba=[parseInt(a[1].slice(0,2),16),parseInt(a[1].slice(2,4),16),parseInt(a[1].slice(4,6),16),parseInt(a[1].slice(6,8),16)/255];else if(a[1].length===6)s.format="hex",s.rgba=[parseInt(a[1].slice(0,2),16),parseInt(a[1].slice(2,4),16),parseInt(a[1].slice(4,6),16),null];else if(a[1].length===3)s.format="hex",s.rgba=[parseInt(a[1].charAt(0)+a[1].charAt(0),16),parseInt(a[1].charAt(1)+a[1].charAt(1),16),parseInt(a[1].charAt(2)+a[1].charAt(2),16),null];else return!1;return s}if(a=i.match(/^\W*rgba?\(([^)]*)\)\W*$/i)){var o=a[1].split(","),l=/^\s*(\d+|\d*\.\d+|\d+\.\d*)\s*$/,c,d,f,p;if(o.length>=3&&(c=o[0].match(l))&&(d=o[1].match(l))&&(f=o[2].match(l)))return s.format="rgb",s.rgba=[parseFloat(c[1])||0,parseFloat(d[1])||0,parseFloat(f[1])||0,null],o.length>=4&&(p=o[3].match(l))&&(s.format="rgba",s.rgba[3]=parseFloat(p[1])||0),s}return!1},parsePaletteValue:function(i){var s=[];typeof i=="string"?i.replace(/#[0-9A-F]{3}\b|#[0-9A-F]{6}([0-9A-F]{2})?\b|rgba?\(([^)]*)\)/ig,function(c){s.push(c)}):Array.isArray(i)&&(s=i);for(var a=[],o=0;o<s.length;o++){var l=e.parseColorString(s[o]);l&&a.push(l)}return a},containsTranparentColor:function(i){for(var s=0;s<i.length;s++){var a=i[s].rgba[3];if(a!==null&&a<1)return!0}return!1},isAlphaFormat:function(i){switch(i.toLowerCase()){case"hexa":case"rgba":return!0}return!1},scaleCanvasForHighDPR:function(i){var s=t.devicePixelRatio||1;i.width*=s,i.height*=s;var a=i.getContext("2d");a.scale(s,s)},genColorPreviewCanvas:function(i,s,a,o){var l=Math.round(e.pub.previewSeparator.length),c=e.pub.chessboardSize,d=e.pub.chessboardColor1,f=e.pub.chessboardColor2,p=a||c*2,x=c*2,_=e.createEl("canvas"),g=_.getContext("2d");_.width=p,_.height=x,o&&e.scaleCanvasForHighDPR(_),g.fillStyle=d,g.fillRect(0,0,p,x),g.fillStyle=f;for(var y=0;y<p;y+=c*2)g.fillRect(y,0,c,c),g.fillRect(y+c,c,c,c);i&&(g.fillStyle=i,g.fillRect(0,0,p,x));var P=null;switch(s){case"left":P=0,g.clearRect(0,0,l/2,x);break;case"right":P=p-l,g.clearRect(p-l/2,0,l/2,x);break}if(P!==null){g.lineWidth=1;for(var L=0;L<e.pub.previewSeparator.length;L+=1)g.beginPath(),g.strokeStyle=e.pub.previewSeparator[L],g.moveTo(.5+P+L,0),g.lineTo(.5+P+L,x),g.stroke()}return{canvas:_,width:p,height:x}},genColorPreviewGradient:function(i,s,a){var o=[];return s&&a?o=["to "+{left:"right",right:"left"}[s],i+" 0%",i+" "+a+"px","rgba(0,0,0,0) "+(a+1)+"px","rgba(0,0,0,0) 100%"]:o=["to right",i+" 0%",i+" 100%"],e.linearGradient.apply(this,o)},redrawPosition:function(){if(!(!e.picker||!e.picker.owner)){var i=e.picker.owner;if(i.container!==t.document.body)e._drawPosition(i,0,0,"relative",!1);else{var s,a;i.fixed?(s=e.getElementPos(i.targetElement,!0),a=[0,0]):(s=e.getElementPos(i.targetElement),a=e.getViewPos());var o=e.getElementSize(i.targetElement),l=e.getViewSize(),c=e.getPickerDims(i),d=[c.borderW,c.borderH],f,p,x;switch(i.position.toLowerCase()){case"left":f=1,p=0,x=-1;break;case"right":f=1,p=0,x=1;break;case"top":f=0,p=1,x=-1;break;default:f=0,p=1,x=1;break}var _=(o[p]+d[p])/2;if(i.smartPosition)var g=[-a[f]+s[f]+d[f]>l[f]&&-a[f]+s[f]+o[f]/2>l[f]/2&&s[f]+o[f]-d[f]>=0?s[f]+o[f]-d[f]:s[f],-a[p]+s[p]+o[p]+d[p]-_+_*x>l[p]?-a[p]+s[p]+o[p]/2>l[p]/2&&s[p]+o[p]-_-_*x>=0?s[p]+o[p]-_-_*x:s[p]+o[p]-_+_*x:s[p]+o[p]-_+_*x>=0?s[p]+o[p]-_+_*x:s[p]+o[p]-_-_*x];else var g=[s[f],s[p]+o[p]-_+_*x];var y=g[f],P=g[p],L=i.fixed?"fixed":"absolute",z=(g[0]+d[0]>s[0]||g[0]<s[0]+o[0])&&g[1]+d[1]<s[1]+o[1];e._drawPosition(i,y,P,L,z)}}},_drawPosition:function(i,s,a,o,l){var c=l?0:i.shadowBlur;e.picker.wrap.style.position=o,(Math.round(parseFloat(e.picker.wrap.style.left))!==Math.round(s)||Math.round(parseFloat(e.picker.wrap.style.top))!==Math.round(a))&&(e.picker.wrap.style.left=s+"px",e.picker.wrap.style.top=a+"px"),e.setBoxShadow(e.picker.boxS,i.shadow?new e.BoxShadow(0,c,i.shadowBlur,0,i.shadowColor):null)},getPickerDims:function(i){var s=2*i.controlBorderWidth+i.width,a=2*i.controlBorderWidth+i.height,o=2*i.controlBorderWidth+2*e.getControlPadding(i)+i.sliderSize;e.getSliderChannel(i)&&(s+=o),i.hasAlphaChannel()&&(s+=o);var l=e.getPaletteDims(i,s);l.height&&(a+=l.height+i.padding),i.closeButton&&(a+=2*i.controlBorderWidth+i.padding+i.buttonHeight);var c=s+2*i.padding,d=a+2*i.padding;return{contentW:s,contentH:a,paddedW:c,paddedH:d,borderW:c+2*i.borderWidth,borderH:d+2*i.borderWidth,palette:l}},getPaletteDims:function(i,s){var a=0,o=0,l=0,c=0,d=0,f=i._palette?i._palette.length:0;return f&&(a=i.paletteCols,o=a>0?Math.ceil(f/a):0,l=Math.max(1,Math.floor((s-(a-1)*i.paletteSpacing)/a)),c=i.paletteHeight?Math.min(i.paletteHeight,l):l),o&&(d=o*c+(o-1)*i.paletteSpacing),{cols:a,rows:o,cellW:l,cellH:c,width:s,height:d}},getControlPadding:function(i){return Math.max(i.padding/2,2*i.pointerBorderWidth+i.pointerThickness-i.controlBorderWidth)},getPadYChannel:function(i){switch(i.mode.charAt(1).toLowerCase()){case"v":return"v"}return"s"},getSliderChannel:function(i){if(i.mode.length>2)switch(i.mode.charAt(2).toLowerCase()){case"s":return"s";case"v":return"v"}return null},triggerCallback:function(i,s){if(i[s]){var a=null;if(typeof i[s]=="string")try{a=new Function(i[s])}catch(o){console.error(o)}else a=i[s];a&&a.call(i)}},triggerGlobal:function(i){for(var s=e.getInstances(),a=0;a<s.length;a+=1)s[a].trigger(i)},_pointerMoveEvent:{mouse:"mousemove",touch:"touchmove"},_pointerEndEvent:{mouse:"mouseup",touch:"touchend"},_pointerOrigin:null,onDocumentKeyUp:function(i){["Tab","Escape"].indexOf(e.eventKey(i))!==-1&&e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onWindowResize:function(i){e.redrawPosition()},onWindowScroll:function(i){e.redrawPosition()},onParentScroll:function(i){e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onDocumentMouseDown:function(i){var s=i.target||i.srcElement;if(s.jscolor&&s.jscolor instanceof e.pub)s.jscolor.showOnClick&&!s.disabled&&s.jscolor.show();else if(e.getData(s,"gui")){var a=e.getData(s,"control");a&&e.onControlPointerStart(i,s,e.getData(s,"control"),"mouse")}else e.picker&&e.picker.owner&&e.picker.owner.tryHide()},onPickerTouchStart:function(i){var s=i.target||i.srcElement;e.getData(s,"control")&&e.onControlPointerStart(i,s,e.getData(s,"control"),"touch")},onControlPointerStart:function(i,s,a,o){var l=e.getData(s,"instance");e.preventDefault(i);var c=function(_,g){e.attachGroupEvent("drag",_,e._pointerMoveEvent[o],e.onDocumentPointerMove(i,s,a,o,g)),e.attachGroupEvent("drag",_,e._pointerEndEvent[o],e.onDocumentPointerEnd(i,s,a,o))};if(c(t.document,[0,0]),t.parent&&t.frameElement){var d=t.frameElement.getBoundingClientRect(),f=[-d.left,-d.top];c(t.parent.window.document,f)}var p=e.getAbsPointerPos(i),x=e.getRelPointerPos(i);switch(e._pointerOrigin={x:p.x-x.x,y:p.y-x.y},a){case"pad":e.getSliderChannel(l)==="v"&&l.channels.v===0&&l.fromHSVA(null,null,100,null),e.setPad(l,i,0,0);break;case"sld":e.setSld(l,i,0);break;case"asld":e.setASld(l,i,0);break}l.trigger("input")},onDocumentPointerMove:function(i,s,a,o,l){return function(c){var d=e.getData(s,"instance");switch(a){case"pad":e.setPad(d,c,l[0],l[1]);break;case"sld":e.setSld(d,c,l[1]);break;case"asld":e.setASld(d,c,l[1]);break}d.trigger("input")}},onDocumentPointerEnd:function(i,s,a,o){return function(l){var c=e.getData(s,"instance");e.detachGroupEvents("drag"),c.trigger("input"),c.trigger("change")}},onPaletteSampleClick:function(i){var s=i.currentTarget,a=e.getData(s,"instance"),o=e.getData(s,"color");a.format.toLowerCase()==="any"&&(a._setFormat(o.format),e.isAlphaFormat(a.getFormat())||(o.rgba[3]=1)),o.rgba[3]===null&&(a.paletteSetsAlpha===!0||a.paletteSetsAlpha==="auto"&&a._paletteHasTransparency)&&(o.rgba[3]=1),a.fromRGBA.apply(a,o.rgba),a.trigger("input"),a.trigger("change"),a.hideOnPaletteClick&&a.hide()},setPad:function(i,s,a,o){var l=e.getAbsPointerPos(s),c=a+l.x-e._pointerOrigin.x-i.padding-i.controlBorderWidth,d=o+l.y-e._pointerOrigin.y-i.padding-i.controlBorderWidth,f=c*(360/(i.width-1)),p=100-d*(100/(i.height-1));switch(e.getPadYChannel(i)){case"s":i.fromHSVA(f,p,null,null);break;case"v":i.fromHSVA(f,null,p,null);break}},setSld:function(i,s,a){var o=e.getAbsPointerPos(s),l=a+o.y-e._pointerOrigin.y-i.padding-i.controlBorderWidth,c=100-l*(100/(i.height-1));switch(e.getSliderChannel(i)){case"s":i.fromHSVA(null,c,null,null);break;case"v":i.fromHSVA(null,null,c,null);break}},setASld:function(i,s,a){var o=e.getAbsPointerPos(s),l=a+o.y-e._pointerOrigin.y-i.padding-i.controlBorderWidth,c=1-l*(1/(i.height-1));if(c<1){var d=i.getFormat();i.format.toLowerCase()==="any"&&!e.isAlphaFormat(d)&&i._setFormat(d==="hex"?"hexa":"rgba")}i.fromHSVA(null,null,null,c)},createPadCanvas:function(){var i={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,c,d){s.width=l,s.height=c,a.clearRect(0,0,s.width,s.height);var f=a.createLinearGradient(0,0,s.width,0);f.addColorStop(0/6,"#F00"),f.addColorStop(1/6,"#FF0"),f.addColorStop(2/6,"#0F0"),f.addColorStop(3/6,"#0FF"),f.addColorStop(4/6,"#00F"),f.addColorStop(5/6,"#F0F"),f.addColorStop(6/6,"#F00"),a.fillStyle=f,a.fillRect(0,0,s.width,s.height);var p=a.createLinearGradient(0,0,0,s.height);switch(d.toLowerCase()){case"s":p.addColorStop(0,"rgba(255,255,255,0)"),p.addColorStop(1,"rgba(255,255,255,1)");break;case"v":p.addColorStop(0,"rgba(0,0,0,0)"),p.addColorStop(1,"rgba(0,0,0,1)");break}a.fillStyle=p,a.fillRect(0,0,s.width,s.height)};return i.elm=s,i.draw=o,i},createSliderGradient:function(){var i={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,c,d,f){s.width=l,s.height=c,a.clearRect(0,0,s.width,s.height);var p=a.createLinearGradient(0,0,0,s.height);p.addColorStop(0,d),p.addColorStop(1,f),a.fillStyle=p,a.fillRect(0,0,s.width,s.height)};return i.elm=s,i.draw=o,i},createASliderGradient:function(){var i={elm:null,draw:null},s=e.createEl("canvas"),a=s.getContext("2d"),o=function(l,c,d){s.width=l,s.height=c,a.clearRect(0,0,s.width,s.height);var f=s.width/2,p=e.pub.chessboardColor1,x=e.pub.chessboardColor2;if(a.fillStyle=p,a.fillRect(0,0,s.width,s.height),f>0)for(var _=0;_<s.height;_+=f*2)a.fillStyle=x,a.fillRect(0,_,f,f),a.fillRect(f,_+f,f,f);var g=a.createLinearGradient(0,0,0,s.height);g.addColorStop(0,d),g.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=g,a.fillRect(0,0,s.width,s.height)};return i.elm=s,i.draw=o,i},BoxShadow:function(){var i=function(s,a,o,l,c,d){this.hShadow=s,this.vShadow=a,this.blur=o,this.spread=l,this.color=c,this.inset=!!d};return i.prototype.toString=function(){var s=[Math.round(this.hShadow)+"px",Math.round(this.vShadow)+"px",Math.round(this.blur)+"px",Math.round(this.spread)+"px",this.color];return this.inset&&s.push("inset"),s.join(" ")},i}(),flags:{leaveValue:1,leaveAlpha:2,leavePreview:4},enumOpts:{format:["auto","any","hex","hexa","rgb","rgba"],previewPosition:["left","right"],mode:["hsv","hvs","hs","hv"],position:["left","right","top","bottom"],alphaChannel:["auto",!0,!1],paletteSetsAlpha:["auto",!0,!1]},deprecatedOpts:{styleElement:"previewElement",onFineChange:"onInput",overwriteImportant:"forceStyle",closable:"closeButton",insetWidth:"controlBorderWidth",insetColor:"controlBorderColor",refine:null},docsRef:" See https://jscolor.com/docs/",pub:function(i,s){var a=this;s||(s={}),this.channels={r:255,g:255,b:255,h:0,s:0,v:100,a:1},this.format="auto",this.value=void 0,this.alpha=void 0,this.random=!1,this.onChange=void 0,this.onInput=void 0,this.valueElement=void 0,this.alphaElement=void 0,this.previewElement=void 0,this.previewPosition="left",this.previewSize=32,this.previewPadding=8,this.required=!0,this.hash=!0,this.uppercase=!0,this.forceStyle=!0,this.width=181,this.height=101,this.mode="HSV",this.alphaChannel="auto",this.position="bottom",this.smartPosition=!0,this.showOnClick=!0,this.hideOnLeave=!0,this.palette=[],this.paletteCols=10,this.paletteSetsAlpha="auto",this.paletteHeight=16,this.paletteSpacing=4,this.hideOnPaletteClick=!1,this.sliderSize=16,this.crossSize=8,this.closeButton=!1,this.closeText="Close",this.buttonColor="rgba(0,0,0,1)",this.buttonHeight=18,this.padding=12,this.backgroundColor="rgba(255,255,255,1)",this.borderWidth=1,this.borderColor="rgba(187,187,187,1)",this.borderRadius=8,this.controlBorderWidth=1,this.controlBorderColor="rgba(187,187,187,1)",this.shadow=!0,this.shadowBlur=15,this.shadowColor="rgba(0,0,0,0.2)",this.pointerColor="rgba(76,76,76,1)",this.pointerBorderWidth=1,this.pointerBorderColor="rgba(255,255,255,1)",this.pointerThickness=2,this.zIndex=5e3,this.container=void 0,this.minS=0,this.maxS=100,this.minV=0,this.maxV=100,this.minA=0,this.maxA=1,this.option=function(){if(!arguments.length)throw new Error("No option specified");if(arguments.length===1&&typeof arguments[0]=="string"){try{return l(arguments[0])}catch(S){console.warn(S)}return!1}else if(arguments.length>=2&&typeof arguments[0]=="string"){try{if(!o(arguments[0],arguments[1]))return!1}catch(S){return console.warn(S),!1}return this.redraw(),this.exposeColor(),!0}else if(arguments.length===1&&typeof arguments[0]=="object"){var u=arguments[0],b=!0;for(var C in u)if(u.hasOwnProperty(C))try{o(C,u[C])||(b=!1)}catch(S){console.warn(S),b=!1}return this.redraw(),this.exposeColor(),b}throw new Error("Invalid arguments")},this.channel=function(u,b){if(typeof u!="string")throw new Error("Invalid value for channel name: "+u);if(b===void 0)return this.channels.hasOwnProperty(u.toLowerCase())?this.channels[u.toLowerCase()]:(console.warn("Getting unknown channel: "+u),!1);var C=!1;switch(u.toLowerCase()){case"r":C=this.fromRGBA(b,null,null,null);break;case"g":C=this.fromRGBA(null,b,null,null);break;case"b":C=this.fromRGBA(null,null,b,null);break;case"h":C=this.fromHSVA(b,null,null,null);break;case"s":C=this.fromHSVA(null,b,null,null);break;case"v":C=this.fromHSVA(null,null,b,null);break;case"a":C=this.fromHSVA(null,null,null,b);break;default:return console.warn("Setting unknown channel: "+u),!1}return C?(this.redraw(),!0):!1},this.trigger=function(u){for(var b=e.strList(u),C=0;C<b.length;C+=1){var S=b[C].toLowerCase(),M=null;switch(S){case"input":M="onInput";break;case"change":M="onChange";break}M&&e.triggerCallback(this,M),e.triggerInputEvent(this.valueElement,S,!0,!0)}},this.fromHSVA=function(u,b,C,S,M){if(u===void 0&&(u=null),b===void 0&&(b=null),C===void 0&&(C=null),S===void 0&&(S=null),u!==null){if(isNaN(u))return!1;this.channels.h=Math.max(0,Math.min(360,u))}if(b!==null){if(isNaN(b))return!1;this.channels.s=Math.max(0,Math.min(100,this.maxS,b),this.minS)}if(C!==null){if(isNaN(C))return!1;this.channels.v=Math.max(0,Math.min(100,this.maxV,C),this.minV)}if(S!==null){if(isNaN(S))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,S),this.minA):1}var R=e.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=R[0],this.channels.g=R[1],this.channels.b=R[2],this.exposeColor(M),!0},this.fromRGBA=function(u,b,C,S,M){if(u===void 0&&(u=null),b===void 0&&(b=null),C===void 0&&(C=null),S===void 0&&(S=null),u!==null){if(isNaN(u))return!1;u=Math.max(0,Math.min(255,u))}if(b!==null){if(isNaN(b))return!1;b=Math.max(0,Math.min(255,b))}if(C!==null){if(isNaN(C))return!1;C=Math.max(0,Math.min(255,C))}if(S!==null){if(isNaN(S))return!1;this.channels.a=this.hasAlphaChannel()?Math.max(0,Math.min(1,this.maxA,S),this.minA):1}var R=e.RGB_HSV(u===null?this.channels.r:u,b===null?this.channels.g:b,C===null?this.channels.b:C);R[0]!==null&&(this.channels.h=Math.max(0,Math.min(360,R[0]))),R[2]!==0&&(this.channels.s=Math.max(0,this.minS,Math.min(100,this.maxS,R[1]))),this.channels.v=Math.max(0,this.minV,Math.min(100,this.maxV,R[2]));var w=e.HSV_RGB(this.channels.h,this.channels.s,this.channels.v);return this.channels.r=w[0],this.channels.g=w[1],this.channels.b=w[2],this.exposeColor(M),!0},this.fromHSV=function(u,b,C,S){return console.warn("fromHSV() method is DEPRECATED. Using fromHSVA() instead."+e.docsRef),this.fromHSVA(u,b,C,null,S)},this.fromRGB=function(u,b,C,S){return console.warn("fromRGB() method is DEPRECATED. Using fromRGBA() instead."+e.docsRef),this.fromRGBA(u,b,C,null,S)},this.fromString=function(u,b){if(!this.required&&u.trim()==="")return this.setPreviewElementBg(null),this.setValueElementValue(""),!0;var C=e.parseColorString(u);return C?(this.format.toLowerCase()==="any"&&(this._setFormat(C.format),e.isAlphaFormat(this.getFormat())||(C.rgba[3]=1)),this.fromRGBA(C.rgba[0],C.rgba[1],C.rgba[2],C.rgba[3],b),!0):!1},this.randomize=function(u,b,C,S,M,R,w,$){u===void 0&&(u=0),b===void 0&&(b=100),C===void 0&&(C=0),S===void 0&&(S=100),M===void 0&&(M=0),R===void 0&&(R=359),w===void 0&&(w=1),$===void 0&&($=1),this.fromHSVA(M+Math.floor(Math.random()*(R-M+1)),C+Math.floor(Math.random()*(S-C+1)),u+Math.floor(Math.random()*(b-u+1)),(100*w+Math.floor(Math.random()*(100*($-w)+1)))/100)},this.toString=function(u){switch(u===void 0&&(u=this.getFormat()),u.toLowerCase()){case"hex":return this.toHEXString();case"hexa":return this.toHEXAString();case"rgb":return this.toRGBString();case"rgba":return this.toRGBAString()}return!1},this.toHEXString=function(){return e.hexColor(this.channels.r,this.channels.g,this.channels.b)},this.toHEXAString=function(){return e.hexaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toRGBString=function(){return e.rgbColor(this.channels.r,this.channels.g,this.channels.b)},this.toRGBAString=function(){return e.rgbaColor(this.channels.r,this.channels.g,this.channels.b,this.channels.a)},this.toGrayscale=function(){return .213*this.channels.r+.715*this.channels.g+.072*this.channels.b},this.toCanvas=function(){return e.genColorPreviewCanvas(this.toRGBAString()).canvas},this.toDataURL=function(){return this.toCanvas().toDataURL()},this.toBackground=function(){return e.pub.background(this.toRGBAString())},this.isLight=function(){return this.toGrayscale()>127.5},this.hide=function(){_()&&c()},this.show=function(){d()},this.redraw=function(){_()&&d()},this.getFormat=function(){return this._currentFormat},this._setFormat=function(u){this._currentFormat=u.toLowerCase()},this.hasAlphaChannel=function(){return this.alphaChannel==="auto"?this.format.toLowerCase()==="any"||e.isAlphaFormat(this.getFormat())||this.alpha!==void 0||this.alphaElement!==void 0:this.alphaChannel},this.processValueInput=function(u){this.fromString(u)||this.exposeColor()},this.processAlphaInput=function(u){this.fromHSVA(null,null,null,parseFloat(u))||this.exposeColor()},this.exposeColor=function(u){var b=this.toString(),C=this.getFormat();if(e.setDataAttr(this.targetElement,"current-color",b),!(u&e.flags.leaveValue)&&this.valueElement&&((C==="hex"||C==="hexa")&&(this.uppercase||(b=b.toLowerCase()),this.hash||(b=b.replace(/^#/,""))),this.setValueElementValue(b)),!(u&e.flags.leaveAlpha)&&this.alphaElement){var S=Math.round(this.channels.a*100)/100;this.setAlphaElementValue(S)}!(u&e.flags.leavePreview)&&this.previewElement&&((e.isTextInput(this.previewElement)||e.isButton(this.previewElement)&&!e.isButtonEmpty(this.previewElement))&&this.previewPosition,this.setPreviewElementBg(this.toRGBAString())),_()&&(f(),p(),x())},this.setPreviewElementBg=function(u){if(this.previewElement){var b=null,C=null;(e.isTextInput(this.previewElement)||e.isButton(this.previewElement)&&!e.isButtonEmpty(this.previewElement))&&(b=this.previewPosition,C=this.previewSize);var S=[];if(!u)S.push({image:"none",position:"left top",size:"auto",repeat:"no-repeat",origin:"padding-box"});else{S.push({image:e.genColorPreviewGradient(u,b,C?C-e.pub.previewSeparator.length:null),position:"left top",size:"auto",repeat:b?"repeat-y":"repeat",origin:"padding-box"});var M=e.genColorPreviewCanvas("rgba(0,0,0,0)",b?{left:"right",right:"left"}[b]:null,C,!0);S.push({image:"url('"+M.canvas.toDataURL()+"')",position:(b||"left")+" top",size:M.width+"px "+M.height+"px",repeat:b?"repeat-y":"repeat",origin:"padding-box"})}for(var R={image:[],position:[],size:[],repeat:[],origin:[]},w=0;w<S.length;w+=1)R.image.push(S[w].image),R.position.push(S[w].position),R.size.push(S[w].size),R.repeat.push(S[w].repeat),R.origin.push(S[w].origin);var I={"background-image":R.image.join(", "),"background-position":R.position.join(", "),"background-size":R.size.join(", "),"background-repeat":R.repeat.join(", "),"background-origin":R.origin.join(", ")};e.setStyle(this.previewElement,I,this.forceStyle);var $={left:null,right:null};b&&($[b]=this.previewSize+this.previewPadding+"px");var I={"padding-left":$.left,"padding-right":$.right};e.setStyle(this.previewElement,I,this.forceStyle,!0)}},this.setValueElementValue=function(u){this.valueElement&&(e.nodeName(this.valueElement)==="input"?this.valueElement.value=u:this.valueElement.innerHTML=u)},this.setAlphaElementValue=function(u){this.alphaElement&&(e.nodeName(this.alphaElement)==="input"?this.alphaElement.value=u:this.alphaElement.innerHTML=u)},this._processParentElementsInDOM=function(){if(!this._parentElementsProcessed){this._parentElementsProcessed=!0;var u=this.targetElement;do{var b=e.getCompStyle(u);b.position&&b.position.toLowerCase()==="fixed"&&(this.fixed=!0),u!==this.targetElement&&(e.getData(u,"hasScrollListener")||(u.addEventListener("scroll",e.onParentScroll,!1),e.setData(u,"hasScrollListener",!0)))}while((u=u.parentNode)&&e.nodeName(u)!=="body")}},this.tryHide=function(){this.hideOnLeave&&this.hide()},this.set__palette=function(u){this.palette=u,this._palette=e.parsePaletteValue(u),this._paletteHasTransparency=e.containsTranparentColor(this._palette)};function o(u,b){if(typeof u!="string")throw new Error("Invalid value for option name: "+u);if(e.enumOpts.hasOwnProperty(u)&&(typeof b=="string"&&(b=b.toLowerCase()),e.enumOpts[u].indexOf(b)===-1))throw new Error("Option '"+u+"' has invalid value: "+b);if(e.deprecatedOpts.hasOwnProperty(u)){var C=u,S=e.deprecatedOpts[u];if(S)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+e.docsRef,C,S),u=S;else throw new Error("Option '"+u+"' is DEPRECATED")}var M="set__"+u;if(typeof a[M]=="function")return a[M](b),!0;if(u in a)return a[u]=b,!0;throw new Error("Unrecognized configuration option: "+u)}function l(u){if(typeof u!="string")throw new Error("Invalid value for option name: "+u);if(e.deprecatedOpts.hasOwnProperty(u)){var b=u,C=e.deprecatedOpts[u];if(C)console.warn("Option '%s' is DEPRECATED, using '%s' instead."+e.docsRef,b,C),u=C;else throw new Error("Option '"+u+"' is DEPRECATED")}var S="get__"+u;if(typeof a[S]=="function")return a[S](value);if(u in a)return a[u];throw new Error("Unrecognized configuration option: "+u)}function c(){e.removeClass(a.targetElement,e.pub.activeClassName),e.picker.wrap.parentNode.removeChild(e.picker.wrap),delete e.picker.owner}function d(){a._processParentElementsInDOM(),e.picker||(e.picker={owner:null,wrap:e.createEl("div"),box:e.createEl("div"),boxS:e.createEl("div"),boxB:e.createEl("div"),pad:e.createEl("div"),padB:e.createEl("div"),padM:e.createEl("div"),padCanvas:e.createPadCanvas(),cross:e.createEl("div"),crossBY:e.createEl("div"),crossBX:e.createEl("div"),crossLY:e.createEl("div"),crossLX:e.createEl("div"),sld:e.createEl("div"),sldB:e.createEl("div"),sldM:e.createEl("div"),sldGrad:e.createSliderGradient(),sldPtrS:e.createEl("div"),sldPtrIB:e.createEl("div"),sldPtrMB:e.createEl("div"),sldPtrOB:e.createEl("div"),asld:e.createEl("div"),asldB:e.createEl("div"),asldM:e.createEl("div"),asldGrad:e.createASliderGradient(),asldPtrS:e.createEl("div"),asldPtrIB:e.createEl("div"),asldPtrMB:e.createEl("div"),asldPtrOB:e.createEl("div"),pal:e.createEl("div"),btn:e.createEl("div"),btnT:e.createEl("div")},e.picker.pad.appendChild(e.picker.padCanvas.elm),e.picker.padB.appendChild(e.picker.pad),e.picker.cross.appendChild(e.picker.crossBY),e.picker.cross.appendChild(e.picker.crossBX),e.picker.cross.appendChild(e.picker.crossLY),e.picker.cross.appendChild(e.picker.crossLX),e.picker.padB.appendChild(e.picker.cross),e.picker.box.appendChild(e.picker.padB),e.picker.box.appendChild(e.picker.padM),e.picker.sld.appendChild(e.picker.sldGrad.elm),e.picker.sldB.appendChild(e.picker.sld),e.picker.sldB.appendChild(e.picker.sldPtrOB),e.picker.sldPtrOB.appendChild(e.picker.sldPtrMB),e.picker.sldPtrMB.appendChild(e.picker.sldPtrIB),e.picker.sldPtrIB.appendChild(e.picker.sldPtrS),e.picker.box.appendChild(e.picker.sldB),e.picker.box.appendChild(e.picker.sldM),e.picker.asld.appendChild(e.picker.asldGrad.elm),e.picker.asldB.appendChild(e.picker.asld),e.picker.asldB.appendChild(e.picker.asldPtrOB),e.picker.asldPtrOB.appendChild(e.picker.asldPtrMB),e.picker.asldPtrMB.appendChild(e.picker.asldPtrIB),e.picker.asldPtrIB.appendChild(e.picker.asldPtrS),e.picker.box.appendChild(e.picker.asldB),e.picker.box.appendChild(e.picker.asldM),e.picker.box.appendChild(e.picker.pal),e.picker.btn.appendChild(e.picker.btnT),e.picker.box.appendChild(e.picker.btn),e.picker.boxB.appendChild(e.picker.box),e.picker.wrap.appendChild(e.picker.boxS),e.picker.wrap.appendChild(e.picker.boxB),e.picker.wrap.addEventListener("touchstart",e.onPickerTouchStart,e.isPassiveEventSupported?{passive:!1}:!1));var u=e.picker,b=!!e.getSliderChannel(a),C=a.hasAlphaChannel(),S=e.getPickerDims(a),M=2*a.pointerBorderWidth+a.pointerThickness+2*a.crossSize,R=e.getControlPadding(a),w=Math.min(a.borderRadius,Math.round(a.padding*Math.PI)),$="crosshair";u.wrap.className="jscolor-wrap",u.wrap.style.width=S.borderW+"px",u.wrap.style.height=S.borderH+"px",u.wrap.style.zIndex=a.zIndex,u.box.className="jscolor-picker",u.box.style.width=S.paddedW+"px",u.box.style.height=S.paddedH+"px",u.boxS.className="jscolor-shadow",e.setBorderRadius(u.boxS,w+"px"),u.boxB.className="jscolor-border",u.boxB.style.border=a.borderWidth+"px solid",u.boxB.style.borderColor=a.borderColor,u.boxB.style.background=a.backgroundColor,e.setBorderRadius(u.boxB,w+"px"),u.padM.style.background="rgba(255,0,0,.2)",u.sldM.style.background="rgba(0,255,0,.2)",u.asldM.style.background="rgba(0,0,255,.2)",u.padM.style.opacity=u.sldM.style.opacity=u.asldM.style.opacity="0",u.pad.style.position="relative",u.pad.style.width=a.width+"px",u.pad.style.height=a.height+"px",u.padCanvas.draw(a.width,a.height,e.getPadYChannel(a)),u.padB.style.position="absolute",u.padB.style.left=a.padding+"px",u.padB.style.top=a.padding+"px",u.padB.style.border=a.controlBorderWidth+"px solid",u.padB.style.borderColor=a.controlBorderColor,u.padM.style.position="absolute",u.padM.style.left="0px",u.padM.style.top="0px",u.padM.style.width=a.padding+2*a.controlBorderWidth+a.width+R+"px",u.padM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",u.padM.style.cursor=$,e.setData(u.padM,{instance:a,control:"pad"}),u.cross.style.position="absolute",u.cross.style.left=u.cross.style.top="0",u.cross.style.width=u.cross.style.height=M+"px",u.crossBY.style.position=u.crossBX.style.position="absolute",u.crossBY.style.background=u.crossBX.style.background=a.pointerBorderColor,u.crossBY.style.width=u.crossBX.style.height=2*a.pointerBorderWidth+a.pointerThickness+"px",u.crossBY.style.height=u.crossBX.style.width=M+"px",u.crossBY.style.left=u.crossBX.style.top=Math.floor(M/2)-Math.floor(a.pointerThickness/2)-a.pointerBorderWidth+"px",u.crossBY.style.top=u.crossBX.style.left="0",u.crossLY.style.position=u.crossLX.style.position="absolute",u.crossLY.style.background=u.crossLX.style.background=a.pointerColor,u.crossLY.style.height=u.crossLX.style.width=M-2*a.pointerBorderWidth+"px",u.crossLY.style.width=u.crossLX.style.height=a.pointerThickness+"px",u.crossLY.style.left=u.crossLX.style.top=Math.floor(M/2)-Math.floor(a.pointerThickness/2)+"px",u.crossLY.style.top=u.crossLX.style.left=a.pointerBorderWidth+"px",u.sld.style.overflow="hidden",u.sld.style.width=a.sliderSize+"px",u.sld.style.height=a.height+"px",u.sldGrad.draw(a.sliderSize,a.height,"#000","#000"),u.sldB.style.display=b?"block":"none",u.sldB.style.position="absolute",u.sldB.style.left=a.padding+a.width+2*a.controlBorderWidth+2*R+"px",u.sldB.style.top=a.padding+"px",u.sldB.style.border=a.controlBorderWidth+"px solid",u.sldB.style.borderColor=a.controlBorderColor,u.sldM.style.display=b?"block":"none",u.sldM.style.position="absolute",u.sldM.style.left=a.padding+a.width+2*a.controlBorderWidth+R+"px",u.sldM.style.top="0px",u.sldM.style.width=a.sliderSize+2*R+2*a.controlBorderWidth+(C?0:Math.max(0,a.padding-R))+"px",u.sldM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",u.sldM.style.cursor="default",e.setData(u.sldM,{instance:a,control:"sld"}),u.sldPtrIB.style.border=u.sldPtrOB.style.border=a.pointerBorderWidth+"px solid "+a.pointerBorderColor,u.sldPtrOB.style.position="absolute",u.sldPtrOB.style.left=-(2*a.pointerBorderWidth+a.pointerThickness)+"px",u.sldPtrOB.style.top="0",u.sldPtrMB.style.border=a.pointerThickness+"px solid "+a.pointerColor,u.sldPtrS.style.width=a.sliderSize+"px",u.sldPtrS.style.height=e.pub.sliderInnerSpace+"px",u.asld.style.overflow="hidden",u.asld.style.width=a.sliderSize+"px",u.asld.style.height=a.height+"px",u.asldGrad.draw(a.sliderSize,a.height,"#000"),u.asldB.style.display=C?"block":"none",u.asldB.style.position="absolute",u.asldB.style.left=a.padding+a.width+2*a.controlBorderWidth+R+(b?a.sliderSize+3*R+2*a.controlBorderWidth:0)+"px",u.asldB.style.top=a.padding+"px",u.asldB.style.border=a.controlBorderWidth+"px solid",u.asldB.style.borderColor=a.controlBorderColor,u.asldM.style.display=C?"block":"none",u.asldM.style.position="absolute",u.asldM.style.left=a.padding+a.width+2*a.controlBorderWidth+R+(b?a.sliderSize+2*R+2*a.controlBorderWidth:0)+"px",u.asldM.style.top="0px",u.asldM.style.width=a.sliderSize+2*R+2*a.controlBorderWidth+Math.max(0,a.padding-R)+"px",u.asldM.style.height=2*a.controlBorderWidth+2*a.padding+a.height+"px",u.asldM.style.cursor="default",e.setData(u.asldM,{instance:a,control:"asld"}),u.asldPtrIB.style.border=u.asldPtrOB.style.border=a.pointerBorderWidth+"px solid "+a.pointerBorderColor,u.asldPtrOB.style.position="absolute",u.asldPtrOB.style.left=-(2*a.pointerBorderWidth+a.pointerThickness)+"px",u.asldPtrOB.style.top="0",u.asldPtrMB.style.border=a.pointerThickness+"px solid "+a.pointerColor,u.asldPtrS.style.width=a.sliderSize+"px",u.asldPtrS.style.height=e.pub.sliderInnerSpace+"px",u.pal.className="jscolor-palette",u.pal.style.display=S.palette.rows?"block":"none",u.pal.style.left=a.padding+"px",u.pal.style.top=2*a.controlBorderWidth+2*a.padding+a.height+"px",u.pal.innerHTML="";for(var I=e.genColorPreviewCanvas("rgba(0,0,0,0)"),Y=0,te=0;te<S.palette.rows;te++)for(var k=0;k<S.palette.cols&&Y<a._palette.length;k++,Y++){var v=a._palette[Y],E=e.rgbaColor.apply(null,v.rgba),A=e.createEl("div");A.style.width=S.palette.cellW-2*a.controlBorderWidth+"px",A.style.height=S.palette.cellH-2*a.controlBorderWidth+"px",A.style.backgroundColor=E;var N=e.createEl("div");N.className="jscolor-palette-sw",N.style.left=(S.palette.cols<=1?0:Math.round(10*(k*((S.contentW-S.palette.cellW)/(S.palette.cols-1))))/10)+"px",N.style.top=te*(S.palette.cellH+a.paletteSpacing)+"px",N.style.border=a.controlBorderWidth+"px solid",N.style.borderColor=a.controlBorderColor,v.rgba[3]!==null&&v.rgba[3]<1&&(N.style.backgroundImage="url('"+I.canvas.toDataURL()+"')",N.style.backgroundRepeat="repeat",N.style.backgroundPosition="center center"),e.setData(N,{instance:a,control:"palette-sw",color:v}),N.addEventListener("click",e.onPaletteSampleClick,!1),N.appendChild(A),u.pal.appendChild(N)}function G(){var J=a.controlBorderColor.split(/\s+/),we=J.length<2?J[0]:J[1]+" "+J[0]+" "+J[0]+" "+J[1];u.btn.style.borderColor=we}var K=15;u.btn.className="jscolor-btn jscolor-btn-close",u.btn.style.display=a.closeButton?"block":"none",u.btn.style.left=a.padding+"px",u.btn.style.bottom=a.padding+"px",u.btn.style.padding="0 "+K+"px",u.btn.style.maxWidth=S.contentW-2*a.controlBorderWidth-2*K+"px",u.btn.style.height=a.buttonHeight+"px",u.btn.style.border=a.controlBorderWidth+"px solid",G(),u.btn.style.color=a.buttonColor,u.btn.onmousedown=function(){a.hide()},u.btnT.style.display="inline",u.btnT.style.lineHeight=a.buttonHeight+"px",u.btnT.innerText=a.closeText,f(),p(),x(),e.picker.owner&&e.picker.owner!==a&&e.removeClass(e.picker.owner.targetElement,e.pub.activeClassName),e.picker.owner=a,e.redrawPosition(),u.wrap.parentNode!==a.container&&a.container.appendChild(u.wrap),e.addClass(a.targetElement,e.pub.activeClassName)}function f(){var u=e.getPadYChannel(a),b=Math.round(a.channels.h/360*(a.width-1)),C=Math.round((1-a.channels[u]/100)*(a.height-1)),S=2*a.pointerBorderWidth+a.pointerThickness+2*a.crossSize,M=-Math.floor(S/2);switch(e.picker.cross.style.left=b+M+"px",e.picker.cross.style.top=C+M+"px",e.getSliderChannel(a)){case"s":var R=e.HSV_RGB(a.channels.h,100,a.channels.v),w=e.HSV_RGB(a.channels.h,0,a.channels.v),I="rgb("+Math.round(R[0])+","+Math.round(R[1])+","+Math.round(R[2])+")",Y="rgb("+Math.round(w[0])+","+Math.round(w[1])+","+Math.round(w[2])+")";e.picker.sldGrad.draw(a.sliderSize,a.height,I,Y);break;case"v":var $=e.HSV_RGB(a.channels.h,a.channels.s,100),I="rgb("+Math.round($[0])+","+Math.round($[1])+","+Math.round($[2])+")",Y="#000";e.picker.sldGrad.draw(a.sliderSize,a.height,I,Y);break}e.picker.asldGrad.draw(a.sliderSize,a.height,a.toHEXString())}function p(){var u=e.getSliderChannel(a);if(u){var b=Math.round((1-a.channels[u]/100)*(a.height-1));e.picker.sldPtrOB.style.top=b-(2*a.pointerBorderWidth+a.pointerThickness)-Math.floor(e.pub.sliderInnerSpace/2)+"px"}e.picker.asldGrad.draw(a.sliderSize,a.height,a.toHEXString())}function x(){var u=Math.round((1-a.channels.a)*(a.height-1));e.picker.asldPtrOB.style.top=u-(2*a.pointerBorderWidth+a.pointerThickness)-Math.floor(e.pub.sliderInnerSpace/2)+"px"}function _(){return e.picker&&e.picker.owner===a}function g(u){e.eventKey(u)==="Enter"&&(a.valueElement&&a.processValueInput(a.valueElement.value),a.tryHide())}function y(u){e.eventKey(u)==="Enter"&&(a.alphaElement&&a.processAlphaInput(a.alphaElement.value),a.tryHide())}function P(u){if(!e.getData(u,"internal")){var b=a.valueElement.value;a.processValueInput(a.valueElement.value),e.triggerCallback(a,"onChange"),a.valueElement.value!==b&&e.triggerInputEvent(a.valueElement,"change",!0,!0)}}function L(u){if(!e.getData(u,"internal")){var b=a.alphaElement.value;a.processAlphaInput(a.alphaElement.value),e.triggerCallback(a,"onChange"),e.triggerInputEvent(a.valueElement,"change",!0,!0),a.alphaElement.value!==b&&e.triggerInputEvent(a.alphaElement,"change",!0,!0)}}function z(u){e.getData(u,"internal")||(a.valueElement&&a.fromString(a.valueElement.value,e.flags.leaveValue),e.triggerCallback(a,"onInput"))}function T(u){e.getData(u,"internal")||(a.alphaElement&&a.fromHSVA(null,null,null,parseFloat(a.alphaElement.value),e.flags.leaveAlpha),e.triggerCallback(a,"onInput"),e.triggerInputEvent(a.valueElement,"input",!0,!0))}if(e.pub.options){for(var B in e.pub.options)if(e.pub.options.hasOwnProperty(B))try{o(B,e.pub.options[B])}catch(u){console.warn(u)}}var V=[];s.preset&&(typeof s.preset=="string"?V=s.preset.split(/\s+/):Array.isArray(s.preset)?V=s.preset.slice():console.warn("Unrecognized preset value")),V.indexOf("default")===-1&&V.push("default");for(var q=V.length-1;q>=0;q-=1){var D=V[q];if(D){if(!e.pub.presets.hasOwnProperty(D)){console.warn("Unknown preset: %s",D);continue}for(var B in e.pub.presets[D])if(e.pub.presets[D].hasOwnProperty(B))try{o(B,e.pub.presets[D][B])}catch(b){console.warn(b)}}}var H=["preset"];for(var B in s)if(s.hasOwnProperty(B)&&H.indexOf(B)===-1)try{o(B,s[B])}catch(b){console.warn(b)}if(this.container===void 0?this.container=t.document.body:this.container=e.node(this.container),!this.container)throw new Error("Cannot instantiate color picker without a container element");if(this.targetElement=e.node(i),!this.targetElement){if(typeof i=="string"&&/^[a-zA-Z][\w:.-]*$/.test(i)){var U=i;throw new Error("If '"+U+"' is supposed to be an ID, please use '#"+U+"' or any valid CSS selector.")}throw new Error("Cannot instantiate color picker without a target element")}if(this.targetElement.jscolor&&this.targetElement.jscolor instanceof e.pub)throw new Error("Color picker already installed on this element");if(this.targetElement.jscolor=this,e.addClass(this.targetElement,e.pub.className),e.instances.push(this),e.isButton(this.targetElement)&&(this.targetElement.type.toLowerCase()!=="button"&&(this.targetElement.type="button"),e.isButtonEmpty(this.targetElement))){e.removeChildren(this.targetElement),this.targetElement.appendChild(t.document.createTextNode(""));var be=e.getCompStyle(this.targetElement),ke=parseFloat(be["min-width"])||0;ke<this.previewSize&&e.setStyle(this.targetElement,{"min-width":this.previewSize+"px"},this.forceStyle)}if(this.valueElement===void 0?e.isTextInput(this.targetElement)&&(this.valueElement=this.targetElement):this.valueElement===null||(this.valueElement=e.node(this.valueElement)),this.alphaElement&&(this.alphaElement=e.node(this.alphaElement)),this.previewElement===void 0?this.previewElement=this.targetElement:this.previewElement===null||(this.previewElement=e.node(this.previewElement)),this.valueElement&&e.isTextInput(this.valueElement)){var se={onInput:this.valueElement.oninput};this.valueElement.oninput=null,this.valueElement.addEventListener("keydown",g,!1),this.valueElement.addEventListener("change",P,!1),this.valueElement.addEventListener("input",z,!1),se.onInput&&this.valueElement.addEventListener("input",se.onInput,!1),this.valueElement.setAttribute("autocomplete","off"),this.valueElement.setAttribute("autocorrect","off"),this.valueElement.setAttribute("autocapitalize","off"),this.valueElement.setAttribute("spellcheck",!1)}this.alphaElement&&e.isTextInput(this.alphaElement)&&(this.alphaElement.addEventListener("keydown",y,!1),this.alphaElement.addEventListener("change",L,!1),this.alphaElement.addEventListener("input",T,!1),this.alphaElement.setAttribute("autocomplete","off"),this.alphaElement.setAttribute("autocorrect","off"),this.alphaElement.setAttribute("autocapitalize","off"),this.alphaElement.setAttribute("spellcheck",!1));var le="FFFFFF";this.value!==void 0?le=this.value:this.valueElement&&this.valueElement.value!==void 0&&(le=this.valueElement.value);var Z=void 0;if(this.alpha!==void 0?Z=""+this.alpha:this.alphaElement&&this.alphaElement.value!==void 0&&(Z=this.alphaElement.value),this._currentFormat=null,["auto","any"].indexOf(this.format.toLowerCase())>-1){var ce=e.parseColorString(le);this._currentFormat=ce?ce.format:"hex"}else this._currentFormat=this.format.toLowerCase();this.processValueInput(le),Z!==void 0&&this.processAlphaInput(Z),this.random&&this.randomize.apply(this,Array.isArray(this.random)?this.random:[])}};return e.pub.className="jscolor",e.pub.activeClassName="jscolor-active",e.pub.looseJSON=!0,e.pub.presets={},e.pub.presets.default={},e.pub.presets.light={backgroundColor:"rgba(255,255,255,1)",controlBorderColor:"rgba(187,187,187,1)",buttonColor:"rgba(0,0,0,1)"},e.pub.presets.dark={backgroundColor:"rgba(51,51,51,1)",controlBorderColor:"rgba(153,153,153,1)",buttonColor:"rgba(240,240,240,1)"},e.pub.presets.small={width:101,height:101,padding:10,sliderSize:14,paletteCols:8},e.pub.presets.medium={width:181,height:101,padding:12,sliderSize:16,paletteCols:10},e.pub.presets.large={width:271,height:151,padding:12,sliderSize:24,paletteCols:15},e.pub.presets.thin={borderWidth:1,controlBorderWidth:1,pointerBorderWidth:1},e.pub.presets.thick={borderWidth:2,controlBorderWidth:2,pointerBorderWidth:2},e.pub.sliderInnerSpace=3,e.pub.chessboardSize=8,e.pub.chessboardColor1="#666666",e.pub.chessboardColor2="#999999",e.pub.previewSeparator=["rgba(255,255,255,.65)","rgba(128,128,128,.65)"],e.pub.init=function(){if(!e.initialized)for(t.document.addEventListener("mousedown",e.onDocumentMouseDown,!1),t.document.addEventListener("keyup",e.onDocumentKeyUp,!1),t.addEventListener("resize",e.onWindowResize,!1),t.addEventListener("scroll",e.onWindowScroll,!1),e.appendDefaultCss(),e.pub.install(),e.initialized=!0;e.readyQueue.length;){var i=e.readyQueue.shift();i()}},e.pub.install=function(i){var s=!0;try{e.installBySelector("[data-jscolor]",i)}catch(a){s=!1,console.warn(a)}if(e.pub.lookupClass)try{e.installBySelector("input."+e.pub.lookupClass+", button."+e.pub.lookupClass,i)}catch{}return s},e.pub.ready=function(i){return typeof i!="function"?(console.warn("Passed value is not a function"),!1):(e.initialized?i():e.readyQueue.push(i),!0)},e.pub.trigger=function(i){var s=function(){e.triggerGlobal(i)};e.initialized?s():e.pub.ready(s)},e.pub.hide=function(){e.picker&&e.picker.owner&&e.picker.owner.hide()},e.pub.chessboard=function(i){i||(i="rgba(0,0,0,0)");var s=e.genColorPreviewCanvas(i);return s.canvas.toDataURL()},e.pub.background=function(i){var s=[];s.push(e.genColorPreviewGradient(i));var a=e.genColorPreviewCanvas();return s.push(["url('"+a.canvas.toDataURL()+"')","left top","repeat"].join(" ")),s.join(", ")},e.pub.options={},e.pub.lookupClass="jscolor",e.pub.installByClassName=function(){return console.error('jscolor.installByClassName() is DEPRECATED. Use data-jscolor="" attribute instead of a class name.'+e.docsRef),!1},e.register(),e.pub}();return typeof t.jscolor>"u"&&(t.jscolor=t.JSColor=r),r})})(_n);var Ti=_n.exports;const zi=Ri(Ti);function Ni(){return O` <div id="settings-modal" class="modal">
    <h2>Settings</h2>

    <div class="modal-content">
      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${h.reverseScroll}
          @change=${n=>m({reverseScroll:n.target.checked})} />
        Invert Scroll
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="grid"
          ?checked=${h.grid}
          @change=${n=>m({grid:n.target.checked})} />
        Grid
      </label>

      <label class="form-control toggle">
        <input
          type="checkbox"
          name="debug"
          ?checked=${h.debug}
          @change=${n=>m({debug:n.target.checked})} />
        Debug
      </label>

      <label class="form-control range">
        Symbol Line Width
        <input
          type="range"
          name="line-width"
          min="1"
          max="10"
          .value=${String(h.symbolLineWidth)}
          ?checked=${h.debug}
          @input=${n=>m({symbolLineWidth:Number(n.target.value)})} />
      </label>
    </div>
  </div>`}function Ii(){return O` <div class="panzoom-controls">
    <button class="btn icon" @click=${()=>lt(h.scale-1)}>
      <i class="fa-solid fa-magnifying-glass-minus"></i>
    </button>
    <input
      type="range"
      min=${dn}
      max=${un}
      .value=${String(h.scale)}
      @input=${n=>lt(Number(n.target.value))} />
    <button class="btn icon" @click=${()=>lt(h.scale+1)}>
      <i class="fa-solid fa-magnifying-glass-plus"></i>
    </button>
    <button class="btn icon" @click=${it}>
      <i class="fa-solid fa-expand"></i>
    </button>
  </div>`}/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Vt(n,t){if(n!==void 0){let r=0;for(const e of n)yield t(e,r++)}}const Di=O`<style>
  #debug-pane {
    display: flex;
    flex-direction: column;
  }
  #debug-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background-color: #1a1919;
    padding: 4px;
  }

  #debug-header > h3 {
    margin: 0;
  }

  #debug-header > button {
    display: flex;
    padding: 0;
    border: 0;
    outline: 0;
    background-color: transparent;
    color: #939292;
    font-size: large;
    cursor: pointer;
  }

  #debug-header > button:hover {
    color: red;
  }

  #debug-content {
    display: grid;
    grid-template-columns: auto auto;
    gap: 1px;
    background-color: #1a1919;
    color: #dadada;
    flex-basis: 350px;
    overflow-y: auto;
  }

  #debug-content > * {
    background-color: #2c2c2c;
    padding: 5px;
  }

  #debug-content > h4 {
    margin: 0;
    text-align: right;
    white-space: nowrap;
  }

  .chip-container {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  .chip {
    font-weight: bold;
    padding: 4px;
    border-radius: 5px;
    background: #5e5e5e;
    paint-order: stroke fill;
    text-shadow: 1px 0 0 black, 0 1px 0 black, -1px 0 0 black, 0 -1px 0 black;
    box-shadow: 0 0 2px black;
  }

  .number-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
  }

  .bool-field {
    font-size: large;
    font-weight: bold;
    font-family: monospace;
    background-color: rgba(177, 211, 111, 1);
  }
</style>`;function Hi(){return O`${Di}
    <div id="debug-pane">
      <div id="debug-header">
        <h3>Debug</h3>
        <button @click=${()=>m({debug:!1})}>
          <i class="fa-solid fa-circle-xmark"></i>
        </button>
      </div>
      <div id="debug-content">
        <h4>Scale</h4>
        <span>
          <span class="number-field">${h.scale}</span> pixels per
          pixel
        </span>
        <h4>x pos</h4>
        <span class="number-field">${h.pos.x}</span>
        <h4>y pos</h4>
        <span class="number-field">${h.pos.y}</span>
        <h4>Active Tool</h4>
        <span class="text-field">${h.activeTool}</span>
        <h4>Active Color</h4>
        <span class="number-field">${h.activeColor}</span>
        <h4>Device Pixel Ratio</h4>
        <span>
          <span class="number-field">${devicePixelRatio}</span> device pixel(s)
          per CSS pixel
        </span>
        <h4>Color Palette</h4>
        <div class="chip-container">
          ${Vt(h.yarnPalette,n=>O`<code class="chip" style="background:${n};"
                >${n}</code
              >`)}
        </div>
        <h4>Snapshot Length</h4>
        <span class="number-field">${h.snapshots.length}</span>
        <h4>Held Keys</h4>
        <div class="chip-container">
          ${h.heldKeys.size>0?Vt(h.heldKeys,n=>O`<span class="chip">${n}</span>`):O`<span class="chip">none</span>`}
        </div>
        <h4>Grid</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${h.grid?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${h.grid}</span
          >
        </div>
        <h4>Editing Palette</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${h.editingPalette?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${h.editingPalette}</span
          >
        </div>
        <h4>Show Settings</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${h.showSettings?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${h.showSettings}</span
          >
        </div>
        <h4>Show download</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${h.showDownload?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${h.showDownload}</span
          >
        </div>
        <h4>Show debug</h4>
        <div class="chip-container">
          <span
            class="chip"
            style="background:${h.debug?"rgb(79 161 50)":"rgb(194 55 68)"};"
            >${h.debug}</span
          >
        </div>
      </div>
    </div>`}function Fi(){return O` <div id="symbol-picker">
    <h3>Symbols</h3>
    ${h.symbolMap.map((n,t)=>O`<button
        class="btn solid img ${h.activeSymbol==t?"current":""}"
        @click=${()=>m({activeSymbol:t})}>
        <div>${n}</div>
        <canvas class="symbol-preview" data-symbol=${n}></canvas>
      </button>`)}
  </div>`}function Vi(n){if(h.yarnPalette.length==1){alert("you need some color in your life");return}const t=h.yarnPalette.filter((e,i)=>i!=n),r=h.yarnSequence.pixels.map(e=>e==n?0:e>n?e-1:e);m({yarnPalette:t,yarnSequence:new W(h.yarnSequence.width,h.yarnSequence.height,r)})}function Wt(n){const t=document.getElementById(`color-${n}`);if(!t.jscolor){const r=new zi(t,{preset:"dark large",format:"hexa",value:h.yarnPalette[n],onInput:()=>{const e=[...h.yarnPalette];e[n]=r.toRGBAString(),m({yarnPalette:e,yarnSequence:h.yarnSequence})},previewElement:null})}t.jscolor.show()}function Wi(){return O`<div id="yarn-picker">
    <h3>Yarns</h3>
    <div>
      <button
        class="btn icon ${h.editingPalette?"selected":""}"
        @click=${()=>m({editingPalette:!h.editingPalette})}>
        <i class="fa-solid fa-pen"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{let n=[...h.yarnPalette];n.push(Je()),m({yarnPalette:n})}}>
        <i class="fa-solid fa-plus"></i>
      </button>
    </div>
    ${h.yarnPalette.map((n,t)=>O`<button
          class="btn solid color-select ${t==h.activeYarn?"selected":""}"
          @click=${()=>m({activeYarn:t})}>
          <div class="color-label">${t+1}</div>
          <div class="color-preview" style="--current: ${n};">
            ${h.editingPalette?O`
                  <button
                    class="delete-color-button"
                    @click=${()=>Vi(t)}>
                    <i class="fa-solid fa-circle-xmark"></i>
                  </button>
                  <button
                    id="color-${t}"
                    class="edit-color-btn"
                    @click=${r=>Wt(t)}></button>
                  <div
                    class="edit-color-icon"
                    @click=${r=>Wt(t)}>
                    <i class="fa-solid fa-pen"></i>
                  </div>
                `:""}
          </div>
        </button>`)}

    <div>
      <button
        class="btn icon"
        @click=${()=>{m({yarnPalette:[...vi(h.yarnPalette)]})}}>
        <i class="fa-solid fa-arrows-rotate"></i>
      </button>
      <button
        class="btn icon"
        @click=${()=>{m({yarnPalette:Array.from(Array(h.yarnPalette.length),()=>Je())})}}>
        <i class="fa-solid fa-dice"></i>
      </button>
    </div>
  </div>`}function Oi(){const n=W.empty(2,2,[0,0,0,0]);m({repeats:[...h.repeats,{bitmap:n,area:[n.width,n.height],pos:[0,0]}],editingRepeat:h.repeats.length})}function qi(){return O`<div id="left-bar" class="scroller">
    <button class="btn solid add-repeat" @click=${()=>Oi()}>
      <i class="fa-solid fa-plus"></i>
    </button>
    ${Fi()} ${Wi()}
  </div>`}function Gi(n){return Math.floor(n.pos[0]*h.scale/devicePixelRatio)}function Yi(n){return Math.floor((h.chart.height-n.bitmap.height-n.pos[1])*h.scale/devicePixelRatio)}function Xi(){return O` <div id="repeat-container">
    ${h.repeats.map((n,t)=>O`<div
          data-repeatindex=${t}
          class="repeat-canvas-container"
          style="transform: translate(${Gi(n)}px, ${Yi(n)}px); ${h.editingRepeat==t?"z-index: 3":"z-index: 1"}"
          id="repeat-${t}-container">
          ${ge(h.editingRepeat==t,()=>O`<button class="btn solid resize-repeat grab">
                <i class="fa-solid fa-up-right-and-down-left-from-center"></i>
              </button> `)}
          <div
            class="repeat-bounds"
            style="width: ${n.area[0]*h.scale/devicePixelRatio}px; height: ${n.area[1]*h.scale/devicePixelRatio}px;">
            ${ge(h.editingRepeat==t,()=>O`<button class="repeat-area-dragger y-axis">
                    <i class="fa-solid fa-angles-up"></i></button
                  ><button class="repeat-area-dragger x-axis">
                    <i class="fa-solid fa-angles-right"></i>
                  </button>`)}
          </div>
          <canvas id="repeat-${t}" class="repeat-canvas"></canvas>
          <canvas id="repeat-${t}-grid" class="grid-canvas"></canvas>
          <canvas id="repeat-${t}-outline" class="outline-canvas"></canvas>
        </div>`)}
  </div>`}function Oe(n,t){m({repeats:[...h.repeats.slice(0,n),{...h.repeats[n],bitmap:t},...h.repeats.slice(n+1)]})}function Ui(n,t){function r(e){const i=h.repeats[n].bitmap.line({x:t.x,y:t.y},{x:e.x,y:e.y},h.activeSymbol);t=e,Oe(n,i)}return r(t),r}function Ki(n,t){function r(e){Oe(n,h.repeats[n].bitmap.flood(e,h.activeSymbol))}return r(t),r}function ji(n,t){const r=h.repeats[n].bitmap;function e(i){const s=r.rect({x:t.x,y:t.y},{x:i.x,y:i.y},h.activeSymbol);Oe(n,s)}return e(t),e}function Ji(n,t){const r=h.repeats[n].bitmap;function e(i){const s=r.line({x:t.x,y:t.y},{x:i.x,y:i.y},h.activeSymbol);Oe(n,s)}return e(t),e}function Zi(n,t){const r=h.repeats[n].bitmap;function e(i){Oe(n,r.shift(t.x-i.x,t.y-i.y))}return e(t),e}const He={brush:Ui,flood:Ki,line:Ji,rect:ji,shift:Zi};function Qi(){return O` <div class="tool-picker">
    <button
      class="btn"
      @click=${()=>m({editingRepeat:-1,repeats:[...h.repeats.slice(0,h.editingRepeat),...h.repeats.slice(h.editingRepeat+1)]})}>
      <i class="fa-solid fa-trash"></i>
    </button>
    <span
      >${h.repeats[h.editingRepeat].bitmap.width} x
      ${h.repeats[h.editingRepeat].bitmap.height}
    </span>
    ${Object.keys(He).map(n=>O`<button
        class="btn solid ${h.activeTool==n?"current":""}"
        @click=${()=>m({activeTool:n})}>
        <i class=${mn[n].icon}></i>
      </button>`)}
    <button
      class="btn solid move-repeat ${h.activeTool=="move"?"current":""}"
      @click=${()=>m({activeTool:"move"})}>
      <i class="fa-solid fa-hand"></i>
    </button>
    <button
      class="btn"
      @click=${()=>m({editingRepeat:-1})}>
      <i class="fa-solid fa-circle-xmark"></i>
    </button>
  </div>`}const vt="ECN",Le="PCN",fe="ACN",Ae="UACN",er="K",tr="P",Ot="T",qt="M";class nr{constructor(t,r,e=!0){if(this.width=2*t,this.height=r+1,this.contacts=Array.from({length:this.width*this.height},()=>[null,vt,[null,null]]),e)for(let i=0;i<this.width;i++)this.setAV(i,0,Le),this.setMV(i,0,[0,0])}getST(t,r){return this.neighborhood(t,r)[0]}setSt(t,r,e){this.neighborhood(t,r)[0]=e}getAV(t,r){return this.neighborhood(t,r)[1]}setAV(t,r,e){this.neighborhood(t,r)[1]=e}getMV(t,r){return this.neighborhood(t,r)[2]}getDeltaI(t,r){return this.neighborhood(t,r)[2][0]}getDeltaJ(t,r){return this.neighborhood(t,r)[2][1]}setMV(t,r,e){this.neighborhood(t,r)[2]=e}setDeltaJ(t,r,e){this.neighborhood(t,r)[2][1]=e}setDeltaI(t,r,e){this.neighborhood(t,r)[2][0]=e}neighborhood(t,r){return this.contacts[r*this.width+t]}}class ir{constructor(t){this.instructions=t,this.width=t.width,this.height=t.height,this.cn=new nr(this.width,this.height),this.populateContacts()}handleKPLower(t,r,e){this.cn.setSt(t,r,e);const i=this.cn.getAV(t,r),s=this.cn.getMV(t,r);i==Le&&s[0]===0&&this.cn.setAV(t,r,fe),i==Ae&&((this.cn.getAV(t+1,r-1)==fe&&this.cn.getMV(t+1,r-1)[1]==0||this.cn.getAV(t-1,r-1)==fe&&this.cn.getMV(t-1,r-1)[1]==0)&&this.cn.setAV(t,r,fe),this.cn.getAV(t,r-1)==Le&&this.cn.setAV(t,r-1,fe))}handleKPUpper(t,r){if(this.cn.setMV(t,r+1,[0,0]),this.cn.getAV(t,r)==fe?this.cn.setAV(t,r+1,Le):this.cn.setAV(t,r+1,Ae),this.cn.getAV(t,r)==Ae){let e=!1,i=0,s=0;for(;!e&&!(r-i<0);)if(this.cn.getAV(t,r-i)==="PCN"&&(e=!0,this.cn.setAV(t,r-i,fe)),i++,s++,s>1e3){console.error("COULDN'T FIND STITCH");break}}}handleTuckMissUpper(t,r,e){e==Ot?(this.cn.setAV(t,r+1,Ae),this.cn.setMV(t,r+1,[0,0])):e==qt&&(this.cn.setAV(t,r+1,vt),this.cn.setMV(t,r+1,[0,-1]))}handleTuckMissLower(t,r,e){const i=this.cn.getAV(t,r);if(i==Le||i==Ae)this.cn.setDeltaJ(t,r,1);else if(i==vt){let s=!1,a=0,o=0;for(;!s;){const l=this.cn.getMV(t,r-a)[1];if(l>0&&(this.cn.setDeltaJ(t,r-a,l+1),s=!0),a++,o++,o>1e3){console.error("COULDN'T FIND STITCH");break}}}}handleOp(t,r,e,i){(e==er||e==tr)&&(this.handleKPLower(t,r,e),this.handleKPLower(t+i,r,e),this.handleKPUpper(t,r,e),this.handleKPUpper(t+i,r,e)),(e==Ot||e==qt)&&(this.handleTuckMissLower(t,r,e),this.handleTuckMissLower(t+i,r,e),this.handleTuckMissUpper(t,r,e),this.handleTuckMissUpper(t+i,r,e))}processRow(t,r){if(r)for(let e=0;e<this.width;e++){const i=this.instructions.op(e,t);this.handleOp(2*e,t,i,1)}else for(let e=this.width-1;e>=0;e--){const i=this.instructions.op(e,t);this.handleOp(2*e+1,t,i,-1)}}populateContacts(){let t=!0;for(let r=0;r<this.height;r++)this.processRow(r,t),t=!t}}const rr={T:0,K:1,S:2,p:3},ar=["K","P","M","T"];class sr{constructor(t){this.ops=Array.from(t.pixels).map(r=>ar[r]),this.width=t.width,this.height=t.height}op(t,r){return t>this.width-1||t<0||r>this.height-1||r<0?-1:this.ops.at(t+r*this.width)}makeOpData(){const t=this.width,r=this.height,e=[];for(let i=0;i<r;i++)for(let s=0;s<t;s++){const a=i*t+s,o=this.op(s,i),l=[[2*s,i],[2*s+1,i],[2*s+1,i+1],[2*s,i+1]];e.push({index:a,stitch:o,op:rr[o],cnIndices:l.map(([c,d])=>d*2*t+c)})}return e}}const En="K",Sn="P",or="ECN",lr="ACN",cr="UACN";function hr(n){let t=0,r=0,e=!0,i=0;const s=[];for(;r<n.height;){const a=i%2==0,o=t%2==0,l=a===o?"F":"L";if(ur(t,r,e,s,n)){let c;if(e)c=[t,r,i,l+"L"];else{const d=kn(t,r,n);c=[d.i,d.j,i,l+"H"]}s.push(c)}({i:t,j:r,legNode:e,currentStitchRow:i}=Cn(t,r,e,i,n))}return s}function ur(n,t,r,e,i){if(r)return i.getST(n,t)==En||i.getST(n,t)==Sn;{let s=i.getAV(n,t);if(s==or)return!1;if(s==cr){let a,o,l,c;if(n%2!=t%2)[a,o,l,c]=e.at(-1);else{const f=Cn(n,t,r,t-1,i);a=f.i,o=f.j}const d=kn(n,t,i);return o<d.j?(i.setAV(n,t,lr),!0):!1}else return!0}}function kn(n,t,r){const[e,i]=r.getMV(n,t);return t==r.height-1?{i:n,j:t}:e!=0?mt(n+e,t,r):mt(n,t+i,r)}function mt(n,t,r){return r.getST(n,t)==En||r.getST(n,t)==Sn?{i:n,j:t}:t==r.height-1?{i:n,j:t}:mt(n,t+r.getDeltaJ(n,t),r)}function Cn(n,t,r,e,i){const s=e%2==0,a=n%2==0;let o=n,l=t,c=r;return r?s?a?(l=t+1,c=!1):o=n+1:a?o=n-1:(l=t+1,c=!1):s?a?o=n+1:(l=t-1,c=!0):a?(l=t-1,c=!0):o=n-1,o<0||o>=i.width?{i:n,j:t+1,legNode:!0,currentStitchRow:e+1}:{i:o,j:l,legNode:c,currentStitchRow:e}}function dr(n,t,r,e){return n[t].st=="K"&&n[r].st=="K"?e=="LHLL"||e=="FLFH"?"front":"back":n[t].st=="P"&&n[r].st=="P"?e=="LHLL"||e=="FLFH"?"back":"front":"mid"}class fr{constructor(t){this.width=t.width,this.height=t.height,this.cns=t,this.contactNodes=t.contacts.map((r,e)=>({index:e,st:r[0],cn:r[1],mv:r[2]})),this.yarnPath=hr(t)}yarnPathToLinks(){let t=0,r=this.yarnPath[0][3];const e=[];return this.yarnPath.forEach(([i,s,a,o],l)=>{if(l==0)return;let c=s*this.width+i,d=r+o;e.push({source:t,target:c,linkType:d,row:a,index:l-1,layer:dr(this.contactNodes,t,c,d)}),t=c,r=o}),e}makeNice(){return this.yarnPath.map(([t,r,e,i])=>({cnIndex:r*this.width+t,i:t,j:r,row:e,cnType:i,angle:null,normal:[0,0]}))}}function ht(n){return function(){return n}}function Gt(n){return(n()-.5)*1e-6}function pr(n){return n.index}function Yt(n,t){var r=n.get(t);if(!r)throw new Error("node not found: "+t);return r}function gr(n){var t=pr,r=f,e,i=ht(30),s,a,o,l,c,d=1;n==null&&(n=[]);function f(y){return 1/Math.min(o[y.source.index],o[y.target.index])}function p(y){for(var P=0,L=n.length;P<d;++P)for(var z=0,T,B,V,q,D,H,U;z<L;++z)T=n[z],B=T.source,V=T.target,q=V.x+V.vx-B.x-B.vx||Gt(c),D=V.y+V.vy-B.y-B.vy||Gt(c),H=Math.sqrt(q*q+D*D),T.linkType=="FLFH"||T.linkType=="LHLL"?Math.sign(H-s[z])<=0?H=(H-s[z])/H*y*.001:H=(H-s[z])/H*y*.2:H=(H-s[z])/H*y*.5,q*=H,D*=H,V.vx-=q*(U=l[z]),V.vy-=D*U,B.vx+=q*(U=1-U),B.vy+=D*U}function x(){if(a){var y,P=a.length,L=n.length,z=new Map(a.map((B,V)=>[t(B,V,a),B])),T;for(y=0,o=new Array(P);y<L;++y)T=n[y],T.index=y,typeof T.source!="object"&&(T.source=Yt(z,T.source)),typeof T.target!="object"&&(T.target=Yt(z,T.target)),o[T.source.index]=(o[T.source.index]||0)+1,o[T.target.index]=(o[T.target.index]||0)+1;for(y=0,l=new Array(L);y<L;++y)T=n[y],l[y]=o[T.source.index]/(o[T.source.index]+o[T.target.index]);e=new Array(L),_(),s=new Array(L),g()}}function _(){if(a)for(var y=0,P=n.length;y<P;++y)e[y]=+r(n[y],y,n)}function g(){if(a)for(var y=0,P=n.length;y<P;++y)s[y]=+i(n[y],y,n)}return p.initialize=function(y,P){a=y,c=P,x()},p.links=function(y){return arguments.length?(n=y,x(),p):n},p.id=function(y){return arguments.length?(t=y,p):t},p.iterations=function(y){return arguments.length?(d=+y,p):d},p.strength=function(y){return arguments.length?(r=typeof y=="function"?y:ht(+y),_(),p):r},p.distance=function(y){return arguments.length?(i=typeof y=="function"?y:ht(+y),g(),p):i},p}var vr={value:()=>{}};function Pn(){for(var n=0,t=arguments.length,r={},e;n<t;++n){if(!(e=arguments[n]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new Ue(r)}function Ue(n){this._=n}function mr(n,t){return n.trim().split(/^|\s+/).map(function(r){var e="",i=r.indexOf(".");if(i>=0&&(e=r.slice(i+1),r=r.slice(0,i)),r&&!t.hasOwnProperty(r))throw new Error("unknown type: "+r);return{type:r,name:e}})}Ue.prototype=Pn.prototype={constructor:Ue,on:function(n,t){var r=this._,e=mr(n+"",r),i,s=-1,a=e.length;if(arguments.length<2){for(;++s<a;)if((i=(n=e[s]).type)&&(i=yr(r[i],n.name)))return i;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<a;)if(i=(n=e[s]).type)r[i]=Xt(r[i],n.name,t);else if(t==null)for(i in r)r[i]=Xt(r[i],n.name,null);return this},copy:function(){var n={},t=this._;for(var r in t)n[r]=t[r].slice();return new Ue(n)},call:function(n,t){if((i=arguments.length-2)>0)for(var r=new Array(i),e=0,i,s;e<i;++e)r[e]=arguments[e+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(s=this._[n],e=0,i=s.length;e<i;++e)s[e].value.apply(t,r)},apply:function(n,t,r){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var e=this._[n],i=0,s=e.length;i<s;++i)e[i].value.apply(t,r)}};function yr(n,t){for(var r=0,e=n.length,i;r<e;++r)if((i=n[r]).name===t)return i.value}function Xt(n,t,r){for(var e=0,i=n.length;e<i;++e)if(n[e].name===t){n[e]=vr,n=n.slice(0,e).concat(n.slice(e+1));break}return r!=null&&n.push({name:t,value:r}),n}var Se=0,Me=0,$e=0,An=1e3,Qe,Be,et=0,ye=0,rt=0,Fe=typeof performance=="object"&&performance.now?performance:Date,$n=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Ln(){return ye||($n(br),ye=Fe.now()+rt)}function br(){ye=0}function yt(){this._call=this._time=this._next=null}yt.prototype=Mn.prototype={constructor:yt,restart:function(n,t,r){if(typeof n!="function")throw new TypeError("callback is not a function");r=(r==null?Ln():+r)+(t==null?0:+t),!this._next&&Be!==this&&(Be?Be._next=this:Qe=this,Be=this),this._call=n,this._time=r,bt()},stop:function(){this._call&&(this._call=null,this._time=1/0,bt())}};function Mn(n,t,r){var e=new yt;return e.restart(n,t,r),e}function wr(){Ln(),++Se;for(var n=Qe,t;n;)(t=ye-n._time)>=0&&n._call.call(void 0,t),n=n._next;--Se}function Ut(){ye=(et=Fe.now())+rt,Se=Me=0;try{wr()}finally{Se=0,_r(),ye=0}}function xr(){var n=Fe.now(),t=n-et;t>An&&(rt-=t,et=n)}function _r(){for(var n,t=Qe,r,e=1/0;t;)t._call?(e>t._time&&(e=t._time),n=t,t=t._next):(r=t._next,t._next=null,t=n?n._next=r:Qe=r);Be=n,bt(e)}function bt(n){if(!Se){Me&&(Me=clearTimeout(Me));var t=n-ye;t>24?(n<1/0&&(Me=setTimeout(Ut,n-Fe.now()-rt)),$e&&($e=clearInterval($e))):($e||(et=Fe.now(),$e=setInterval(xr,An)),Se=1,$n(Ut))}}const wt=Math.PI,xt=2*wt,pe=1e-6,Er=xt-pe;function Bn(n){this._+=n[0];for(let t=1,r=n.length;t<r;++t)this._+=arguments[t]+n[t]}function Sr(n){let t=Math.floor(n);if(!(t>=0))throw new Error(`invalid digits: ${n}`);if(t>15)return Bn;const r=10**t;return function(e){this._+=e[0];for(let i=1,s=e.length;i<s;++i)this._+=Math.round(arguments[i]*r)/r+e[i]}}class kr{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Bn:Sr(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,e,i){this._append`Q${+t},${+r},${this._x1=+e},${this._y1=+i}`}bezierCurveTo(t,r,e,i,s,a){this._append`C${+t},${+r},${+e},${+i},${this._x1=+s},${this._y1=+a}`}arcTo(t,r,e,i,s){if(t=+t,r=+r,e=+e,i=+i,s=+s,s<0)throw new Error(`negative radius: ${s}`);let a=this._x1,o=this._y1,l=e-t,c=i-r,d=a-t,f=o-r,p=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(p>pe)if(!(Math.abs(f*l-c*d)>pe)||!s)this._append`L${this._x1=t},${this._y1=r}`;else{let x=e-a,_=i-o,g=l*l+c*c,y=x*x+_*_,P=Math.sqrt(g),L=Math.sqrt(p),z=s*Math.tan((wt-Math.acos((g+p-y)/(2*P*L)))/2),T=z/L,B=z/P;Math.abs(T-1)>pe&&this._append`L${t+T*d},${r+T*f}`,this._append`A${s},${s},0,0,${+(f*x>d*_)},${this._x1=t+B*l},${this._y1=r+B*c}`}}arc(t,r,e,i,s,a){if(t=+t,r=+r,e=+e,a=!!a,e<0)throw new Error(`negative radius: ${e}`);let o=e*Math.cos(i),l=e*Math.sin(i),c=t+o,d=r+l,f=1^a,p=a?i-s:s-i;this._x1===null?this._append`M${c},${d}`:(Math.abs(this._x1-c)>pe||Math.abs(this._y1-d)>pe)&&this._append`L${c},${d}`,e&&(p<0&&(p=p%xt+xt),p>Er?this._append`A${e},${e},0,1,${f},${t-o},${r-l}A${e},${e},0,1,${f},${this._x1=c},${this._y1=d}`:p>pe&&this._append`A${e},${e},0,${+(p>=wt)},${f},${this._x1=t+e*Math.cos(s)},${this._y1=r+e*Math.sin(s)}`)}rect(t,r,e,i){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${e=+e}v${+i}h${-e}Z`}toString(){return this._}}const Cr=1664525,Pr=1013904223,Kt=4294967296;function Ar(){let n=1;return()=>(n=(Cr*n+Pr)%Kt)/Kt}var $r=10,Lr=Math.PI*(3-Math.sqrt(5));function Mr(n){var t,r=1,e=.001,i=1-Math.pow(e,1/300),s=0,a=.6,o=new Map,l=Mn(f),c=Pn("tick","end"),d=Ar();n==null&&(n=[]);function f(){p(),c.call("tick",t),r<e&&(l.stop(),c.call("end",t))}function p(g){var y,P=n.length,L;g===void 0&&(g=1);for(var z=0;z<g;++z)for(r+=(s-r)*i,o.forEach(function(T){T(r)}),y=0;y<P;++y)L=n[y],L.fx==null?L.x+=L.vx*=a:(L.x=L.fx,L.vx=0),L.fy==null?L.y+=L.vy*=a:(L.y=L.fy,L.vy=0);return t}function x(){for(var g=0,y=n.length,P;g<y;++g){if(P=n[g],P.index=g,P.fx!=null&&(P.x=P.fx),P.fy!=null&&(P.y=P.fy),isNaN(P.x)||isNaN(P.y)){var L=$r*Math.sqrt(.5+g),z=g*Lr;P.x=L*Math.cos(z),P.y=L*Math.sin(z)}(isNaN(P.vx)||isNaN(P.vy))&&(P.vx=P.vy=0)}}function _(g){return g.initialize&&g.initialize(n,d),g}return x(),t={tick:p,restart:function(){return l.restart(f),t},stop:function(){return l.stop(),t},nodes:function(g){return arguments.length?(n=g,x(),o.forEach(_),t):n},alpha:function(g){return arguments.length?(r=+g,t):r},alphaMin:function(g){return arguments.length?(e=+g,t):e},alphaDecay:function(g){return arguments.length?(i=+g,t):+i},alphaTarget:function(g){return arguments.length?(s=+g,t):s},velocityDecay:function(g){return arguments.length?(a=1-g,t):1-a},randomSource:function(g){return arguments.length?(d=g,o.forEach(_),t):d},force:function(g,y){return arguments.length>1?(y==null?o.delete(g):o.set(g,_(y)),t):o.get(g)},find:function(g,y,P){var L=0,z=n.length,T,B,V,q,D;for(P==null?P=1/0:P*=P,L=0;L<z;++L)q=n[L],T=g-q.x,B=y-q.y,V=T*T+B*B,V<P&&(D=q,P=V);return D},on:function(g,y){return arguments.length>1?(c.on(g,y),t):c.on(g)}}}function xe(n){return function(){return n}}const jt=1e-12;function Br(n){let t=3;return n.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const e=Math.floor(r);if(!(e>=0))throw new RangeError(`invalid digits: ${r}`);t=e}return n},()=>new kr(t)}function Rr(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function Rn(n){this._context=n}Rn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;default:this._context.lineTo(n,t);break}}};function Tr(n){return new Rn(n)}function zr(n){return n[0]}function Nr(n){return n[1]}function Ir(n,t){var r=xe(!0),e=null,i=Tr,s=null,a=Br(o);n=typeof n=="function"?n:n===void 0?zr:xe(n),t=typeof t=="function"?t:t===void 0?Nr:xe(t);function o(l){var c,d=(l=Rr(l)).length,f,p=!1,x;for(e==null&&(s=i(x=a())),c=0;c<=d;++c)!(c<d&&r(f=l[c],c,l))===p&&((p=!p)?s.lineStart():s.lineEnd()),p&&s.point(+n(f,c,l),+t(f,c,l));if(x)return s=null,x+""||null}return o.x=function(l){return arguments.length?(n=typeof l=="function"?l:xe(+l),o):n},o.y=function(l){return arguments.length?(t=typeof l=="function"?l:xe(+l),o):t},o.defined=function(l){return arguments.length?(r=typeof l=="function"?l:xe(!!l),o):r},o.curve=function(l){return arguments.length?(i=l,e!=null&&(s=i(e)),o):i},o.context=function(l){return arguments.length?(l==null?e=s=null:s=i(e=l),o):e},o}function _t(n,t,r){n._context.bezierCurveTo(n._x1+n._k*(n._x2-n._x0),n._y1+n._k*(n._y2-n._y0),n._x2+n._k*(n._x1-t),n._y2+n._k*(n._y1-r),n._x2,n._y2)}function Ct(n,t){this._context=n,this._k=(1-t)/6}Ct.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:_t(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2,this._x1=n,this._y1=t;break;case 2:this._point=3;default:_t(this,n,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function n(t){function r(e){return new Ct(e,t)}return r.tension=function(e){return n(+e)},r})(0);function Pt(n,t){this._context=n,this._k=(1-t)/6}Pt.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){switch(n=+n,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:_t(this,n,t);break}this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function n(t){function r(e){return new Pt(e,t)}return r.tension=function(e){return n(+e)},r})(0);function Tn(n,t,r){var e=n._x1,i=n._y1,s=n._x2,a=n._y2;if(n._l01_a>jt){var o=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,l=3*n._l01_a*(n._l01_a+n._l12_a);e=(e*o-n._x0*n._l12_2a+n._x2*n._l01_2a)/l,i=(i*o-n._y0*n._l12_2a+n._y2*n._l01_2a)/l}if(n._l23_a>jt){var c=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,d=3*n._l23_a*(n._l23_a+n._l12_a);s=(s*c+n._x1*n._l23_2a-t*n._l12_2a)/d,a=(a*c+n._y1*n._l23_2a-r*n._l12_2a)/d}n._context.bezierCurveTo(e,i,s,a,n._x2,n._y2)}function zn(n,t){this._context=n,this._alpha=t}zn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){if(n=+n,t=+t,this._point){var r=this._x2-n,e=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+e*e,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(n,t):this._context.moveTo(n,t);break;case 1:this._point=2;break;case 2:this._point=3;default:Tn(this,n,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=t}};(function n(t){function r(e){return t?new zn(e,t):new Ct(e,0)}return r.alpha=function(e){return n(+e)},r})(.5);function Nn(n,t){this._context=n,this._alpha=t}Nn.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(n,t){if(n=+n,t=+t,this._point){var r=this._x2-n,e=this._y2-t;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+e*e,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:Tn(this,n,t);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=n,this._y0=this._y1,this._y1=this._y2,this._y2=t}};const Dr=function n(t){function r(e){return t?new Nn(e,t):new Pt(e,0)}return r.alpha=function(e){return n(+e)},r}(.5);function Re(n,t,r){this.k=n,this.x=t,this.y=r}Re.prototype={constructor:Re,scale:function(n){return n===1?this:new Re(this.k*n,this.x,this.y)},translate:function(n,t){return n===0&t===0?this:new Re(this.k,this.x+this.k*n,this.y+this.k*t)},apply:function(n){return[n[0]*this.k+this.x,n[1]*this.k+this.y]},applyX:function(n){return n*this.k+this.x},applyY:function(n){return n*this.k+this.y},invert:function(n){return[(n[0]-this.x)/this.k,(n[1]-this.y)/this.k]},invertX:function(n){return(n-this.x)/this.k},invertY:function(n){return(n-this.y)/this.k},rescaleX:function(n){return n.copy().domain(n.range().map(this.invertX,this).map(n.invert,n))},rescaleY:function(n){return n.copy().domain(n.range().map(this.invertY,this).map(n.invert,n))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Re.prototype;const Hr=1,Xe=0,Jt=5/3,Fr=.24,Vr=.88,Wr=.05,Or=.3,qr=1,Gr=.2,Yr=.7,Zt=devicePixelRatio;function Xr(n,t,r,e){let i=!1,s,a,o,l=new Set(t),c={...r,border:"#00000033"};performance.clearMeasures(),performance.mark("start");function d(w){const $=Math.min(H*.9/B.width,U*.9/B.height*Jt),I=$/2;a=$/Jt,s=$*Fr;const Y=s+(H-B.width*$)/2,te=-s+(U-B.height*a)/2;return w.contactNodes.forEach((k,v)=>{const E=v%w.width,A=(v-E)/w.width;k.i=E,k.j=A,k.x=Y+E*I,k.y=te+(w.height-A)*a}),w.contactNodes}function f(w,$,I){if(w.index===$.index)return[0,0];const Y=w.x-$.x,te=w.y-$.y,k=Vr*Math.sqrt(Y**2+te**2);return I?[-te/k,Y/k]:[te/k,-Y/k]}function p(){M[0].normal=f(S[M[0].cnIndex],S[M[1].cnIndex],!0);for(let w=1;w<M.length-1;w++){let $;M[w].cnType=="FH"||M[w].cnType=="LH"?M[w].row%2==0?$=!0:$=!1:M[w].row%2==0?$=!1:$=!0,M[w].normal=f(S[M[w-1].cnIndex],S[M[w+1].cnIndex],$)}M.at(-1).normal=f(S[M.at(-2).cnIndex],S[M.at(-1).cnIndex],!0)}const x=Ir().x(w=>S[w.cnIndex].x+s/2*w.normal[0]).y(w=>S[w.cnIndex].y+s/2*w.normal[1]).curve(Dr);function _(w){const $=w.index;if($==0||$>R.length-3)return`M ${w.source.x} ${w.source.y} ${w.target.x} ${w.target.y}`;const I=[M[$-1],M[$],M[$+1],M[$+2]];return x(I)}function g(){const w={front:{border:[]},back:{border:[]},mid:{border:[]}};for(const $ of l)w.front[$]=[],w.back[$]=[],w.mid[$]=[];return w}function y(w){return w<Xe||w>=B.height-Xe?"border":t[(w-Xe)%t.length]}function P(w,$){w.lineWidth=s,Object.entries($).forEach(([I,Y])=>{w.strokeStyle=c[I],w.stroke(new Path2D(Y.join()))})}function L(){u.clearRect(0,0,H,U),ce.clearRect(0,0,H,U),Z.clearRect(0,0,H,U),p();const w=g();R.forEach(($,I)=>{if(I==0||I>R.length-3)return;const Y=y($.row);w[$.layer][Y].push(_($))}),P(Z,w.back),P(u,w.front),P(ce,w.mid)}function z(){i||(o=Mr(S).alphaMin(Or).alphaDecay(Wr).force("link",gr(R).strength(Gr).iterations(qr).distance(w=>w.linkType=="FLFH"||w.linkType=="LHLL"?a*Yr:Math.abs(w.source.x-w.target.x))).on("tick",L),i=!0)}function T(){o&&o.stop()}const B=new sr(n.pad(Hr,Xe,0)),V=document.getElementById("sim-container").getBoundingClientRect(),q=V.width*e,D=V.height*e,H=Zt*q,U=Zt*D;function be(w){return w.map($=>{let I=document.getElementById($);return I.width=H,I.height=U,I.style.cssText=`width: ${q}px; height: ${D}px;`,I})}let[ke,se,le]=be(["back","mid","front"]);const Z=ke.getContext("2d"),ce=se.getContext("2d"),u=le.getContext("2d"),b=new ir(B),C=new fr(b.cn),S=d(C),M=C.makeNice(),R=C.yarnPathToLinks();return L(),{relax:z,stopSim:T}}let ut,In;function Ur(){return O`<div id="sim-pane">
    <div id="sim-container">
      <div
        style="transform: translate(${h.simPan.x}px, ${h.simPan.y}px)"
        class=${h.flipped?"mirrored":""}>
        <canvas
          id="back"
          class=${h.flipped?"top":"bottom"}></canvas>
        <canvas id="mid" class="mid"></canvas>
        <canvas
          id="front"
          class=${h.flipped?"bottom":"top"}></canvas>
      </div>
    </div>
    <div id="sim-controls" class="panzoom-controls">
      <button @click=${In} class="btn solid">relax</button>
      <button
        @click=${()=>m({flipped:!h.flipped})}
        class="btn solid">
        flip
      </button>
      <button
        class="btn icon"
        @click=${()=>ct(h.simScale*.9)}>
        <i class="fa-solid fa-magnifying-glass-minus"></i>
      </button>
      <input
        type="range"
        min=${pn}
        max=${fn}
        step="0.1"
        .value=${String(h.simScale)}
        @input=${n=>ct(Number(n.target.value))} />
      <button
        class="btn icon"
        @click=${()=>ct(h.simScale*1.1)}>
        <i class="fa-solid fa-magnifying-glass-plus"></i>
      </button>
      <button
        @click=${()=>m({simPan:{x:0,y:0},simScale:1})}
        class="btn icon">
        <i class="fa-solid fa-expand"></i>
      </button>
    </div>
  </div>`}const Kr=(n,t)=>{let r=null;return(...e)=>{window.clearTimeout(r),r=window.setTimeout(()=>{n.apply(null,e)},t)}};function jr(){return({state:n})=>{function t(){ut&&ut(),{stopSim:ut,relax:In}=Xr(h.chart,h.yarnSequence.pixels,h.yarnPalette,h.simScale)}const r=Kr(t,30);return t(),{syncState(e,i){["repeats","yarnPalette","yarnSequence","chart"].some(a=>i.includes(a))&&r(),i.includes("simScale")&&t()}}}}function Jr(){return O`
    ${ge(h.showDownload,Li)}
    ${ge(h.showLibrary,Mi)}
    ${ge(h.showSettings,Ni)} ${Si()}

    <div id="site">
      <div id="chart-pane">
        <div id="chart-layout">
          ${qi()}

          <div id="desktop">
            ${ge(h.editingRepeat>-1,Qi)}
            <div
              id="canvas-transform-group"
              style="transform: translate(${Math.floor(h.chartPan.x)}px, ${Math.floor(h.chartPan.y)}px);">
              <div id="yarn-sequence">
                <button id="color-dragger" class="btn solid grab">
                  <i class="fa-solid fa-grip"></i>
                </button>
                <canvas id="yarn-sequence-canvas"></canvas>
              </div>
              <canvas id="yarn-color-canvas"></canvas>
              <canvas id="symbol-canvas"></canvas>
              <canvas id="grid" class="grid-canvas"></canvas>
              ${Xi()}
            </div>
          </div>
          ${Ii()}
        </div>
      </div>
      ${Ur()}
    </div>
    ${ge(h.debug,Hi)}
  `}function Zr({canvas:n}){return({state:t})=>{let{scale:r,yarnSequence:e,yarnPalette:i}=t,s=e.width,a=e.height,o=null;function l(){const c=n.getContext("2d");for(let d=0;d<a;d++)for(let f=0;f<s;f++){let p=e.pixel(f,a-d-1);(o==null||o.pixel(f,a-d-1)!=p)&&(c.translate(f*r,d*r),c.fillStyle=i[p],c.clearRect(0,0,r,r),c.fillRect(0,0,r,r),c.setTransform(1,0,0,1,0,0))}o=e}return Ze(n,s,a),l(),{syncState(c){i!=c.yarnPalette&&(i=c.yarnPalette,o=null),(r!=c.scale||s!=c.yarnSequence.width||a!=c.yarnSequence.height)&&(s=c.yarnSequence.width,a=c.yarnSequence.height,r=c.scale,Ze(n,s,a),o=null),o!=c.yarnSequence&&(e=c.yarnSequence,l())}}}}function Qr(n){return({state:t})=>{let{scale:r,yarnPalette:e,yarnSequence:i,chart:s}=t,a=null,o=s.width,l=s.height,c=i.height;function d(){const f=n.getContext("2d");for(let p=0;p<l;p++){let x=i.pixel(0,(l-p-1)%c);(a==null||a.pixel(0,(l-p-1)%c)!=x)&&(f.fillStyle=e[x],f.fillRect(0,p*r,o*r,r))}a=i}return a=null,d(),{syncState(f){i=f.yarnSequence,(o!=f.chart.width||l!=f.chart.height||c!=f.yarnSequence.height||r!=f.scale)&&(o=f.chart.width,l=f.chart.height,c=f.yarnSequence.height,r=f.scale,a=null),e!=f.yarnPalette&&(e=f.yarnPalette,a=null),a!=f.yarnSequence&&(i=f.yarnSequence,d())}}}}function ea(n){return({state:t})=>{let{scale:r,symbolMap:e,chart:i,symbolLineWidth:s}=t,a=null,o=i.width,l=i.height;function c(){const d=n.getContext("2d");d.lineWidth=.01*s,d.resetTransform(),d.translate(-.5,-.5);for(let f=0;f<l;f++)for(let p=0;p<o;p++){let x=i.pixel(p,f);if(a==null||a.pixel(p,f)!=x){const _=e[x];d.save(),d.translate(p*r,(l-f-1)*r),d.scale(r,r),d.clearRect(0,0,1,1),vn[_]&&(d.fillStyle="#fff",d.fillRect(0,0,1,1)),d.stroke(St[_]),d.restore()}}a=i}return a=null,c(),{syncState(d){(o!=d.chart.width||l!=d.chart.height||r!=d.scale||s!=d.symbolLineWidth)&&(o=d.chart.width,l=d.chart.height,r=d.scale,s=d.symbolLineWidth,a=null),a!=d.chart&&(i=d.chart,c())}}}}function ta(n){return({state:t})=>{let{scale:r,chart:e,grid:i}=t,s=e.width,a=e.height;function o(){if(!i)return;const l=n.getContext("2d");if(r<15){l.clearRect(0,0,n.width,n.height);return}l.save(),l.translate(-.5,-.5),l.clearRect(0,0,n.width,n.height),l.beginPath();for(let c=0;c<s;c++)l.moveTo(c*r,0),l.lineTo(c*r,a*r+1);for(let c=0;c<a;c++)l.moveTo(0,c*r),l.lineTo(s*r+1,c*r);l.stroke(),l.restore()}return Ze(n,s,a),o(),{syncState(l){(r!=l.scale||s!=l.chart.width||a!=l.chart.height||i!=l.grid)&&(s=l.chart.width,a=l.chart.height,r=l.scale,i=l.grid,Ze(n,s,a),o())}}}}function Qt(n){for(const t of n)t.bitmap=null}function na(){return({state:n})=>{let{scale:t,symbolMap:r,repeats:e,symbolLineWidth:i}=n,s=e.map(d=>({bitmap:null,pos:[...d.pos]}));function a(d,f,p){[document.getElementById(`repeat-${d}`),document.getElementById(`repeat-${d}-grid`),document.getElementById(`repeat-${d}-outline`)].forEach(_=>{if(_==null){s[d].bitmap=null;return}_.width=h.scale*f,_.height=h.scale*p,_.style.width=`${h.scale*f/devicePixelRatio}px`,_.style.height=`${h.scale*p/devicePixelRatio}px`})}function o(d){if(!h.grid)return;const f=document.getElementById(`repeat-${d}-grid`),p=f.getContext("2d"),x=e[d].bitmap.width,_=e[d].bitmap.height;if(t<15){p.clearRect(0,0,f.width,f.height);return}p.save(),p.translate(-.5,-.5),p.clearRect(0,0,f.width,f.height),p.beginPath();for(let g=0;g<x;g++)p.moveTo(g*t,0),p.lineTo(g*t,_*t+1);for(let g=0;g<_;g++)p.moveTo(0,g*t),p.lineTo(x*t+1,g*t);p.stroke(),p.restore()}function l(d){const f=document.getElementById(`repeat-${d}`).getContext("2d");f.imageSmoothingEnabled=!1,f.lineWidth=.01*i,f.resetTransform(),f.translate(-.5,-.5);const p=e[d].bitmap;for(let x=0;x<p.height;x++)for(let _=0;_<p.width;_++){let g=p.pixel(_,x);if(s[d].bitmap==null||s[d].bitmap.pixel(_,x)!=g){const y=r[g];f.save(),f.translate(_*t,x*t),f.scale(t,t),f.clearRect(0,0,1,1),vn[y]?(f.fillStyle="#fff",f.strokeStyle="#000"):(f.fillStyle="#000",f.strokeStyle="#fff"),f.fillRect(0,0,1,1),f.stroke(St[y]),f.restore()}}s[d].bitmap=p}function c(){s=e.map(d=>({bitmap:null,pos:[...d.pos]}));for(let d=0;d<e.length;d++)a(d,e[d].bitmap.width,e[d].bitmap.height),l(d),o(d)}return{syncState(d){if(e=d.repeats,s.length!=e.length&&c(),i!=d.symbolLineWidth&&(i=d.symbolLineWidth,Qt(s)),t!=d.scale){t=d.scale,Qt(s);for(let f=0;f<e.length;f++)a(f,e[f].bitmap.width,e[f].bitmap.height),o(f)}for(let f=0;f<e.length;f++){let p=e[f];(s[f].bitmap==null||p.bitmap.width!=s[f].bitmap.width||p.bitmap.height!=s[f].bitmap.height)&&(a(f,e[f].bitmap.width,e[f].bitmap.height),o(f),s[f].bitmap=null),s[f].bitmap!=p.bitmap&&l(f)}}}}}const en={a:()=>console.log("select all?"),z:()=>yn(),s:()=>m({showDownload:!0})},tn={...Object.fromEntries(Object.entries(mn).map(([n,t])=>[t.hotkey,()=>m({activeTool:n})])),g:()=>m({grid:!h.grid}),Escape:()=>m({showLibrary:!1,showSettings:!1,showDownload:!1,editingRepeat:-1,showRepeatLibrary:!1}),d:()=>m({debug:!h.debug})};function ia(n){n<=h.symbolMap.length&&m({activeSymbol:n})}function ra(){window.addEventListener("keydown",n=>{n.ctrlKey&&n.key.toLowerCase()in en?(n.preventDefault(),en[n.key.toLowerCase()]()):n.key in tn?tn[n.key]():/^[0-9]$/i.test(n.key)&&ia(Number(n.key)-1);const t=new Set(h.heldKeys);t.add(n.key),m({heldKeys:t})}),window.addEventListener("keyup",n=>{const t=new Set(h.heldKeys);t.delete(n.key),m({heldKeys:t})})}function aa(n,t){const r={x:n.clientX,y:n.clientY},e=h.chartPan;function i(a){if(a.buttons==0)s();else{const o=r.x-a.clientX,l=r.y-a.clientY;m({chartPan:{x:e.x-o,y:e.y-l}})}}function s(){t.removeEventListener("pointermove",i),t.removeEventListener("pointerup",s),t.removeEventListener("pointerleave",s)}t.addEventListener("pointermove",i),t.addEventListener("pointerup",s),t.addEventListener("pointerleave",s)}function sa(n){n.addEventListener("pointerdown",t=>{(t.target==n||t.target.id=="symbol-canvas")&&aa(t,n)}),n.addEventListener("pointermove",t=>{const{x:r,y:e}=ue(t,n);(h.pos.x!=r||h.pos.y!=e)&&m({pos:{x:r,y:e}})}),n.addEventListener("pointerleave",t=>{m({pos:{x:-1,y:-1}})}),n.addEventListener("wheel",t=>{const r=n.getBoundingClientRect();let e;Math.sign(t.deltaY)<0?e=h.reverseScroll?h.scale-1:h.scale+1:e=h.reverseScroll?h.scale+1:h.scale-1,wn({x:t.clientX-r.left,y:t.clientY-r.top},e)})}function oa(n,t){let r=je(n,t);m({yarnSequence:h.yarnSequence.brush({x:r.x,y:r.y},h.activeYarn)});function e(s){let a=je(s,t);if(a.x==r.x&&a.y==r.y)return;const o=h.yarnSequence.line({x:r.x,y:r.y},{x:a.x,y:a.y},h.activeYarn);m({yarnSequence:o}),r=a}function i(){m({transforming:!1}),t.removeEventListener("pointermove",e),t.removeEventListener("pointerup",i),t.removeEventListener("pointerleave",i)}t.addEventListener("pointermove",e),t.addEventListener("pointerup",i),t.addEventListener("pointerleave",i)}function la(n){const t=h.yarnSequence,r=n.clientY;document.body.classList.add("grabbing"),n.target.classList.remove("grab");function e(){document.body.classList.remove("grabbing"),m({transforming:!1}),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",e),n.target.classList.add("grab")}function i(s){let a=t.height+Math.floor((r-s.clientY)/h.scale*devicePixelRatio);a<1||a==h.yarnSequence.height||m({yarnSequence:t.resize(1,a,h.activeYarn)})}window.addEventListener("pointermove",i),window.addEventListener("pointerup",e)}function ca(n,t){n.addEventListener("pointerdown",r=>{m({transforming:!0}),oa(r,n)}),t.addEventListener("pointerdown",r=>{m({transforming:!0}),la(r)})}function ha(n){for(n=n.parentNode;n;){if(n.hasAttribute("data-repeatindex"))return Number(n.dataset.repeatindex);n=n.parentNode}return null}function ua(n,t,r){let e=h.repeatPos;m({transforming:!0});let i=r(n,e);if(!i)return;function s(o){if(o.buttons==0)a();else{let l=h.repeatPos;if(l.x==e.x&&l.y==e.y)return;i(l),e=l}}function a(){m({transforming:!1}),t.removeEventListener("pointermove",s),t.removeEventListener("pointerup",a),t.removeEventListener("pointerleave",a)}t.addEventListener("pointermove",s),t.addEventListener("pointerup",a),t.addEventListener("pointerleave",a)}function da(n,t){const r=h.repeats[t],e=[n.clientX,n.clientY],i=n.target;m({transforming:!0}),document.body.classList.add("grabbing"),i.classList.remove("grab");const s=()=>{m({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",s),i.classList.add("grab")},a=o=>{let l=r.bitmap.width-Math.floor((e[0]-o.clientX)/(h.scale/devicePixelRatio)),c=r.bitmap.height+Math.floor((e[1]-o.clientY)/(h.scale/devicePixelRatio));if(c<1||l<1)return;let d=[...r.pos];l+r.pos[0]<1&&(d[0]=-l+1),c+r.pos[1]<1&&(d[1]=-c+1);let f=[l>r.area[0]?l:r.area[0],c>r.area[1]?c:r.area[1]];m({repeats:[...h.repeats.slice(0,t),{...h.repeats[t],bitmap:r.bitmap.vFlip().resize(l,c).vFlip(),pos:d,area:f},...h.repeats.slice(t+1)]})};window.addEventListener("pointermove",a),window.addEventListener("pointerup",s)}function fa(n,t){let r=h.repeats[t];const e=[...r.pos],i=[n.clientX,n.clientY];m({transforming:!0});const s=()=>{m({transforming:!1}),window.removeEventListener("pointermove",a),window.removeEventListener("pointerup",s)},a=o=>{let l=e[0]-Math.floor((i[0]-o.clientX)/(h.scale/devicePixelRatio)),c=e[1]+Math.floor((i[1]-o.clientY)/(h.scale/devicePixelRatio));l=l<-(r.bitmap.width-1)?-(r.bitmap.width-1):l,c=c<-(r.bitmap.height-1)?-(r.bitmap.height-1):c,l=l>h.chart.width-1?h.chart.width-1:l,c=c>h.chart.height-1?h.chart.height-1:c,m({repeats:[...h.repeats.slice(0,t),{...r,pos:[l,c]},...h.repeats.slice(t+1)]})};window.addEventListener("pointermove",a),window.addEventListener("pointerup",s)}function nn(n,t,r){let e=h.repeats[t];const i=r=="x"?e.area[0]:e.area[1],s=[n.clientX,n.clientY],a=n.target;m({transforming:!0}),document.body.classList.add("grabbing"),a.classList.remove("grab");const o=()=>{m({transforming:!1}),document.body.classList.remove("grabbing"),window.removeEventListener("pointermove",l),window.removeEventListener("pointerup",o),a.classList.add("grab")},l=c=>{let d,f;r=="x"?(d=i-Math.floor((s[0]-c.clientX)/(h.scale/devicePixelRatio)),d=d<e.bitmap.width?e.bitmap.width:d,f={...e,area:[d,h.repeats[t].area[1]]}):(d=i+Math.floor((s[1]-c.clientY)/(h.scale/devicePixelRatio)),d=d<e.bitmap.height?e.bitmap.height:d,f={...h.repeats[t],area:[h.repeats[t].area[0],d]}),m({repeats:[...h.repeats.slice(0,t),f,...h.repeats.slice(t+1)]})};window.addEventListener("pointermove",l),window.addEventListener("pointerup",o)}function pa(n){n.addEventListener("pointerdown",t=>{const r=ha(t.target);let e=t.target.classList;if(h.editingRepeat!=r&&e.contains("repeat-canvas")){console.log("NOW EDITING REPEAT",r),m({editingRepeat:r});return}if(e.contains("resize-repeat"))da(t,r);else if(e.contains("repeat-area-dragger"))e.contains("x-axis")?nn(t,r,"x"):nn(t,r,"y");else if(e.contains("repeat-canvas")){const i=h.activeTool;i in He?ua(r,t.target,He[i]):i=="move"?fa(t,r):console.warn(`Uh oh, ${i} is not a tool`)}}),n.addEventListener("pointermove",t=>{if(h.editingRepeat<0){const{x:r,y:e}=ue(t,n);(h.pos.x!=r||h.pos.y!=e)&&m({pos:{x:r,y:e}})}else{const{x:r,y:e}=ue(t,t.target);(h.pos.x!=r||h.pos.y!=e)&&m({repeatPos:{x:r,y:e}})}})}function ga(n,t){const r={x:n.clientX,y:n.clientY},e=h.simPan;function i(a){if(a.buttons==0)s();else{const o=r.x-a.clientX,l=r.y-a.clientY;m({simPan:{x:e.x-o,y:e.y-l}})}}function s(){t.removeEventListener("pointermove",i),t.removeEventListener("pointerup",s),t.removeEventListener("pointerleave",s)}t.addEventListener("pointermove",i),t.addEventListener("pointerup",s),t.addEventListener("pointerleave",s)}function va(n){n.addEventListener("wheel",t=>{let r;const e=n.getBoundingClientRect();Math.sign(t.deltaY)<0?r=h.reverseScroll?h.simScale*.9:h.simScale*1.1:r=h.reverseScroll?h.simScale*1.1:h.simScale*.9,bn({x:(t.clientX-e.left)/2,y:(t.clientY-e.top)/2},r)}),n.addEventListener("pointerdown",t=>{m({editingRepeat:-1}),ga(t,n)})}function ma(n){function t(r,e){const i={x:r.touches[0].clientX,y:r.touches[0].clientY},s=h.chartPan;function a(l){const c=i.x-l.touches[0].clientX,d=i.y-l.touches[0].clientY;m({chartPan:{x:s.x-c,y:s.y-d}})}function o(){e.removeEventListener("touchmove",a),e.removeEventListener("touchcancel",o),e.removeEventListener("touchend",o)}e.addEventListener("touchmove",a),e.addEventListener("touchcancel",o),e.addEventListener("touchend",o)}n.addEventListener("touchstart",r=>{const{x:e,y:i}=ue(r.touches[0],n);(h.pos.x!=e||h.pos.y!=i)&&m({pos:{x:e,y:i}}),(r.target.id=="symbol-canvas"||r.target.id=="desktop")&&t(r,n)}),n.addEventListener("touchmove",r=>{const{x:e,y:i}=ue(r,n);(h.pos.x!=e||h.pos.y!=i)&&m({pos:{x:e,y:i}})}),n.addEventListener("touchmove",r=>{const{x:e,y:i}=ue(r.touches[0],n);(h.pos.x!=e||h.pos.y!=i)&&m({pos:{x:e,y:i}})}),n.addEventListener("touchend",r=>{m({pos:{x:-1,y:-1}})}),n.addEventListener("touchcancel",r=>{m({pos:{x:-1,y:-1}})})}function ya(n,t){let r=je(n.touches[0],t);m({yarnSequence:h.yarnSequence.brush({x:r.x,y:r.y},h.activeYarn)});function e(s){let a=je(s.touches[0],t);if(a.x==r.x&&a.y==r.y)return;const o=h.yarnSequence.line({x:r.x,y:r.y},{x:a.x,y:a.y},h.activeYarn);m({yarnSequence:o}),r=a}function i(){m({transforming:!1}),t.removeEventListener("touchmove",e),t.removeEventListener("touchcancel",i),t.removeEventListener("touchend",i)}t.addEventListener("touchmove",e),t.addEventListener("touchcancel",i),t.addEventListener("touchend",i)}function ba(n){const t=h.yarnSequence,r=n.touches[0].clientY,e=()=>{m({transforming:!1}),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e)},i=s=>{let a=t.height+Math.floor((r-s.touches[0].clientY)/h.scale*devicePixelRatio);a<1||a==t.height||m({yarnSequence:t.resize(1,a,h.activeYarn)})};window.addEventListener("touchmove",i),window.addEventListener("touchend",e),window.addEventListener("touchcancel",e)}function wa(n,t){n.addEventListener("touchstart",r=>{m({transforming:!0}),ya(r,n)}),t.addEventListener("touchstart",r=>{m({transforming:!0}),ba(r)})}function xa(n){for(n=n.parentNode;n;){if(n.hasAttribute("data-repeatindex"))return Number(n.dataset.repeatindex);n=n.parentNode}return null}function _a(n,t,r){let e=h.repeatPos;m({transforming:!0});let i=r(n,e);if(!i)return;function s(){let o=h.repeatPos;o.x==e.x&&o.y==e.y||(i(o),e=o)}function a(){m({transforming:!1}),t.removeEventListener("touchmove",s),t.removeEventListener("touchend",a),t.removeEventListener("touchcancel",a)}t.addEventListener("touchmove",s),t.addEventListener("touchend",a),t.addEventListener("touchcancel",a)}function Ea(n,t){const r=h.repeats[t],e=[n.clientX,n.clientY],i=n.target;m({transforming:!0}),document.body.classList.add("grabbing"),i.classList.remove("grab");const s=()=>{m({transforming:!1}),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o=>{let l=r.bitmap.width-Math.floor((e[0]-o.touches[0].clientX)/(h.scale/devicePixelRatio)),c=r.bitmap.height+Math.floor((e[1]-o.touches[0].clientY)/(h.scale/devicePixelRatio));if(c==r.height&&l==r.width||c<1||l<1)return;let d=[...r.pos];l+r.pos[0]<1&&(d[0]=-l+1),c+r.pos[1]<1&&(d[1]=-c+1);let f=[l>r.area[0]?l:r.area[0],c>r.area[1]?c:r.area[1]];m({repeats:[...h.repeats.slice(0,t),{...h.repeats[t],bitmap:r.bitmap.vFlip().resize(l,c).vFlip(),pos:d,area:f},...h.repeats.slice(t+1)]})};window.addEventListener("touchmove",a),window.addEventListener("touchcancel",s),window.addEventListener("touchend",s)}function Sa(n,t){let r=h.repeats[t];const e=[...h.repeats[t].pos],i=[n.clientX,n.clientY];console.log(i),m({transforming:!0});const s=()=>{m({transforming:!1}),window.removeEventListener("touchmove",a),window.removeEventListener("touchend",s),window.removeEventListener("touchcancel",s)},a=o=>{let l=e[0]-Math.floor((i[0]-o.touches[0].clientX)/(h.scale/devicePixelRatio)),c=e[1]+Math.floor((i[1]-o.touches[0].clientY)/(h.scale/devicePixelRatio));l=l<-(r.bitmap.width-1)?-(r.bitmap.width-1):l,c=c<-(r.bitmap.height-1)?-(r.bitmap.height-1):c,l=l>h.chart.width-1?h.chart.width-1:l,c=c>h.chart.height-1?h.chart.height-1:c,m({repeats:[...h.repeats.slice(0,t),{...r,pos:[l,c]},...h.repeats.slice(t+1)]})};window.addEventListener("touchmove",a),window.addEventListener("touchcancel",s),window.addEventListener("touchend",s)}function rn(n,t){if(h.editingRepeat<0){const{x:r,y:e}=ue(n,t);(h.pos.x!=r||h.pos.y!=e)&&m({pos:{x:r,y:e}})}else{const{x:r,y:e}=ue(n,n.target);(h.pos.x!=r||h.pos.y!=e)&&m({repeatPos:{x:r,y:e}})}}function an(n,t,r){let e=h.repeats[t];const i=r=="x"?e.area[0]:e.area[1],s=[n.clientX,n.clientY];m({transforming:!0});const a=()=>{m({transforming:!1}),window.removeEventListener("touchmove",o),window.removeEventListener("touchend",a),window.removeEventListener("touchcancel",a)},o=l=>{let c,d;r=="x"?(c=i-Math.floor((s[0]-l.touches[0].clientX)/(h.scale/devicePixelRatio)),c=c<e.bitmap.width?e.bitmap.width:c,d={...h.repeats[t],area:[c,h.repeats[t].area[1]]}):(c=i+Math.floor((s[1]-l.touches[0].clientY)/(h.scale/devicePixelRatio)),c=c<e.bitmap.height?e.bitmap.height:c,d={...h.repeats[t],area:[h.repeats[t].area[0],c]}),m({repeats:[...h.repeats.slice(0,t),d,...h.repeats.slice(t+1)]})};window.addEventListener("touchmove",o),window.addEventListener("touchcancel",a),window.addEventListener("touchend",a)}function ka(n){n.addEventListener("touchstart",t=>{rn(t.touches[0],n);const r=xa(t.target);let e=t.target.classList;if(h.editingRepeat!=r&&e.contains("repeat-canvas")){m({editingRepeat:r});return}if(e.contains("resize-repeat"))Ea(t.touches[0],r);else if(e.contains("repeat-area-dragger"))e.contains("x-axis")?an(t.touches[0],r,"x"):an(t.touches[0],r,"y");else if(e.contains("repeat-canvas")){const i=h.activeTool;i in He?_a(r,t.target,He[i]):i=="move"?Sa(t.touches[0],r):console.console.warn(`Uh oh, ${i} is not a tool`)}}),n.addEventListener("touchmove",t=>{rn(t.touches[0],n)})}function Ca(n,t){const r={x:n.clientX,y:n.clientY},e=h.simPan;function i(a){const o=r.x-a.touches[0].clientX,l=r.y-a.touches[0].clientY;m({simPan:{x:e.x-o,y:e.y-l}})}function s(){t.removeEventListener("touchmove",i),t.removeEventListener("touchcancel",s),t.removeEventListener("touchend",s)}t.addEventListener("touchmove",i),t.addEventListener("touchcancel",s),t.addEventListener("touchend",s)}function Pa(n){n.addEventListener("touchstart",t=>{Ca(t.touches[0],n)})}function Aa(n){return({state:t})=>{let{symbolMap:r,symbolLineWidth:e}=t;function i(){r.forEach(s=>{const a=document.querySelector(`[data-symbol=${s}]`);a.width=50,a.height=50;const o=a.getContext("2d");o.scale(50,50),o.imageSmoothingEnabled=!1,o.lineWidth=.01*e,o.stroke(St[s])})}return i(),{syncState(s){e!=s.symbolLineWidth&&(e=s.symbolLineWidth,i())}}}}function $a(n,t,r,e){n.width=e*t,n.height=e*r,n.style.width=`${e*t/devicePixelRatio}px`,n.style.height=`${e*r/devicePixelRatio}px`}function La(n){return({state:t})=>{let{scale:r,chart:e}=t,i=e.width,s=e.height;function a(){n.forEach(o=>{$a(o,i,s,r)})}return{syncState(o){(i!=o.chart.width||s!=o.chart.height||r!=o.scale)&&(i=o.chart.width,s=o.chart.height,r=o.scale,a())}}}}function Dn(){document.getElementById("site").addEventListener("pointerdown",n=>{m({showLibrary:!1,showSettings:!1,showDownload:!1})})}function Ma(){return({state:n})=>{let t=n.repeats;function r(){let e=W.empty(h.chart.width,h.chart.height,0);for(const i of t){let s=W.fromTile(i.area[0],i.area[1],i.bitmap.vFlip()).vFlip();e=e.overlay(s,i.pos)}m({chart:e})}return r(),{syncState(e){t!=e.repeats&&(t=e.repeats,r())}}}}let dt,ft,pt,At,$t,tt,Lt,Mt;function Hn(){Jn(Jr(),document.body),window.requestAnimationFrame(Hn)}function Ba(){ra(),sa(At),pa($t),ca(tt,Lt),va(Mt),Dn()}function Ra(){document.body.style.setProperty("--font-size","1.1rem"),ma(At),ka($t),wa(tt,Lt),Pa(Mt),Dn()}function Fn(){document.documentElement.style.setProperty("--vh",`${window.innerHeight*.01}px`),document.documentElement.style.setProperty("--vw",`${window.innerWidth*.01}px`)}function Ta(){Hn(),dt=document.getElementById("symbol-canvas"),ft=document.getElementById("grid"),pt=document.getElementById("yarn-color-canvas"),tt=document.getElementById("yarn-sequence-canvas"),At=document.getElementById("desktop"),$t=document.getElementById("repeat-container"),Mt=document.getElementById("sim-container"),document.getElementById("repeat-library"),Lt=document.getElementById("color-dragger"),ni(["#chart-pane","#sim-pane"],{sizes:[60,40],minSize:100,gutterSize:11}),fi()?Ra():Ba(),kt.register([La([dt,ft,pt]),Zr({canvas:tt}),ea(dt),Qr(pt),ta(ft),na(),Aa(),jr(),Ma()]),Fn(),it()}window.onload=Ta;window.onresize=Fn;
